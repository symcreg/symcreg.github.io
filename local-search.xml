<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>impedance control with visp_ros</title>
    <link href="/2024/09/06/impedance-control-with-visp-ros/"/>
    <url>/2024/09/06/impedance-control-with-visp-ros/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h2 id="ä»£ç ">ä»£ç </h2><p>å…ˆæŠŠä»£ç è´´ä¸Šæ¥ï¼Œåé¢è¿›è¡Œæ€»ç»“ï¼ŒåŒæ—¶ç»“åˆchatgptè®°å½•ä¸€ä¸‹å…¶ä¸­çš„æ•°å­¦åŸç†ã€‚<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;visp_ros/vpROSRobotFrankaCoppeliasim.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;base_tool_func.h&quot;</span></span><br><br>symc::SystemInfo sys_info;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>** argv)</span></span>&#123;<br>    symc::OptSettings opt_settings;<br>    <span class="hljs-keyword">if</span>(symc::<span class="hljs-built_in">ArgHandle</span>(argc, argv, opt_settings) == <span class="hljs-number">1</span>)&#123;<br>        <span class="hljs-keyword">return</span> EXIT_SUCCESS;<br>    &#125;<br>    symc::SignalManager::<span class="hljs-built_in">RegisterSignalHandlers</span>();<br>    vpROSRobotFrankaCoppeliasim robot;<br>    <span class="hljs-keyword">try</span>&#123;<br>        ros::<span class="hljs-built_in">init</span>(argc, argv, <span class="hljs-string">&quot;visp_ros&quot;</span>, ros::init_options::NoSigintHandler);<br>        ros::NodeHandlePtr n = boost::<span class="hljs-built_in">make_shared</span>&lt;ros::NodeHandle&gt;();<br>        <span class="hljs-function">ros::Rate <span class="hljs-title">loop_rate</span><span class="hljs-params">(<span class="hljs-number">1000</span>)</span></span>;<br>        ros::<span class="hljs-built_in">spinOnce</span>();<br>        robot.<span class="hljs-built_in">setVerbose</span>(opt_settings.verbose);<br>        robot.<span class="hljs-built_in">connect</span>();<br>        symc::<span class="hljs-built_in">ResetSimulation</span>(robot);<br><br>        <span class="hljs-function">vpColVector <span class="hljs-title">q_init</span><span class="hljs-params">( &#123; <span class="hljs-number">0</span>, vpMath::rad( <span class="hljs-number">-45</span> ), <span class="hljs-number">0</span>, vpMath::rad( <span class="hljs-number">-135</span> ), <span class="hljs-number">0</span>, vpMath::rad( <span class="hljs-number">90</span> ), vpMath::rad( <span class="hljs-number">45</span> ) &#125; )</span></span>;<br>        symc::<span class="hljs-built_in">InitRobotPosition</span>(robot, q_init);<br><br>        <span class="hljs-function">vpColVector <span class="hljs-title">q</span><span class="hljs-params">(<span class="hljs-number">7</span>,<span class="hljs-number">0</span>)</span></span>; <span class="hljs-comment">// joint position</span><br>        <span class="hljs-function">vpColVector <span class="hljs-title">q_dot</span><span class="hljs-params">(<span class="hljs-number">7</span>,<span class="hljs-number">0</span>)</span></span>; <span class="hljs-comment">// joint velocity</span><br>        <span class="hljs-function">vpColVector <span class="hljs-title">x_error</span><span class="hljs-params">(<span class="hljs-number">6</span>,<span class="hljs-number">0</span>)</span></span>; <span class="hljs-comment">// error in cartesian space</span><br>        <span class="hljs-function">vpColVector <span class="hljs-title">x_dot_error</span><span class="hljs-params">(<span class="hljs-number">6</span>,<span class="hljs-number">0</span>)</span></span>; <span class="hljs-comment">// error in cartesian velocity</span><br>        <span class="hljs-function">vpColVector <span class="hljs-title">x_dot_desired</span><span class="hljs-params">(<span class="hljs-number">6</span>,<span class="hljs-number">0</span>)</span></span>; <span class="hljs-comment">// desired cartesian velocity</span><br>        <span class="hljs-function">vpColVector <span class="hljs-title">x_dot_dot_desired</span><span class="hljs-params">(<span class="hljs-number">6</span>,<span class="hljs-number">0</span>)</span></span>; <span class="hljs-comment">// desired cartesian acceleration</span><br>        <span class="hljs-function">vpColVector <span class="hljs-title">C</span><span class="hljs-params">(<span class="hljs-number">7</span>,<span class="hljs-number">0</span>)</span></span>; <span class="hljs-comment">// Coriolis and centrifugal forces</span><br>        <span class="hljs-function">vpColVector <span class="hljs-title">F</span><span class="hljs-params">(<span class="hljs-number">7</span>,<span class="hljs-number">0</span>)</span></span>; <span class="hljs-comment">// friction forces</span><br><br>        <span class="hljs-function">vpColVector <span class="hljs-title">tau0</span><span class="hljs-params">(<span class="hljs-number">7</span>,<span class="hljs-number">0</span>)</span></span>; <span class="hljs-comment">// initial joint torque</span><br>        <span class="hljs-function">vpColVector <span class="hljs-title">tau</span><span class="hljs-params">(<span class="hljs-number">7</span>,<span class="hljs-number">0</span>)</span></span>; <span class="hljs-comment">// joint torque</span><br>        <span class="hljs-function">vpColVector <span class="hljs-title">tau_desired</span><span class="hljs-params">(<span class="hljs-number">7</span>,<span class="hljs-number">0</span>)</span></span>; <span class="hljs-comment">// desired joint torque</span><br>        <span class="hljs-function">vpColVector <span class="hljs-title">tau_cmd</span><span class="hljs-params">(<span class="hljs-number">7</span>,<span class="hljs-number">0</span>)</span></span>; <span class="hljs-comment">// joint torque command</span><br><br>        <span class="hljs-function">vpMatrix <span class="hljs-title">fJe</span><span class="hljs-params">(<span class="hljs-number">6</span>,<span class="hljs-number">7</span>)</span></span>; <span class="hljs-comment">// Jacobian matrix</span><br>        <span class="hljs-function">vpMatrix <span class="hljs-title">Ja</span><span class="hljs-params">(<span class="hljs-number">6</span>,<span class="hljs-number">7</span>)</span></span>; <span class="hljs-comment">// Jacobian matrix</span><br>        <span class="hljs-function">vpMatrix <span class="hljs-title">Ja_dot</span><span class="hljs-params">(<span class="hljs-number">6</span>,<span class="hljs-number">7</span>)</span></span>; <span class="hljs-comment">// Jacobian matrix derivative</span><br>        <span class="hljs-function">vpMatrix <span class="hljs-title">Ja_old</span><span class="hljs-params">(<span class="hljs-number">6</span>,<span class="hljs-number">7</span>)</span></span>; <span class="hljs-comment">// old Jacobian matrix</span><br>        <span class="hljs-function">vpMatrix <span class="hljs-title">B</span><span class="hljs-params">(<span class="hljs-number">7</span>,<span class="hljs-number">7</span>)</span></span>; <span class="hljs-comment">// joint space inertia matrix</span><br>        <span class="hljs-function">vpMatrix <span class="hljs-title">I7</span><span class="hljs-params">(<span class="hljs-number">7</span>,<span class="hljs-number">7</span>)</span></span>; <span class="hljs-comment">// identity matrix</span><br>        <span class="hljs-function">vpMatrix <span class="hljs-title">Ja_pinv_B_t</span><span class="hljs-params">(<span class="hljs-number">7</span>,<span class="hljs-number">6</span>)</span></span>; <span class="hljs-comment">// pseudo-inverse of the Jacobian matrix multiplied by the inertia matrix</span><br>        I<span class="hljs-number">7.</span><span class="hljs-built_in">eye</span>();<br>        &#123;<br>            robot.<span class="hljs-built_in">getPosition</span>(vpRobot::JOINT_STATE, q);<br>            std::cout&lt;&lt;<span class="hljs-string">&quot;Initial joint position: &quot;</span>&lt;&lt;q.<span class="hljs-built_in">t</span>()&lt;&lt;std::endl;<br>        &#125;<br>        robot.<span class="hljs-built_in">setRobotState</span>(vpRobot::STATE_FORCE_TORQUE_CONTROL);<br>        robot.<span class="hljs-built_in">setCoppeliasimSyncMode</span>(opt_settings.coppeliasim_sync_mode);<br><br>        vpHomogeneousMatrix fMed, fMed0, fMe;<br>        fMed = fMed0 = robot.<span class="hljs-built_in">get_fMe</span>();<br><br>        <span class="hljs-function">vpMatrix <span class="hljs-title">K</span><span class="hljs-params">(<span class="hljs-number">6</span>,<span class="hljs-number">6</span>)</span></span>;<br>        <span class="hljs-function">vpMatrix <span class="hljs-title">D</span><span class="hljs-params">(<span class="hljs-number">6</span>,<span class="hljs-number">6</span>)</span></span>;<br>        <span class="hljs-function">vpMatrix <span class="hljs-title">edVf</span><span class="hljs-params">(<span class="hljs-number">6</span>,<span class="hljs-number">6</span>)</span></span>;<br><br>        <span class="hljs-type">double</span> wp = <span class="hljs-number">50.0</span>; <span class="hljs-comment">// position control gain</span><br>        <span class="hljs-type">double</span> wo = <span class="hljs-number">20.0</span>; <span class="hljs-comment">// orientation control gain</span><br><br>        K.<span class="hljs-built_in">diag</span>(&#123;wp*wp, wp*wp, wp*wp, wo*wo, wo*wo, wo*wo&#125;);<br>        D.<span class="hljs-built_in">diag</span>(&#123;<span class="hljs-number">2</span>*wp, <span class="hljs-number">2</span>*wp, <span class="hljs-number">2</span>*wp, <span class="hljs-number">2</span>*wo, <span class="hljs-number">2</span>*wo, <span class="hljs-number">2</span>*wo&#125;);<br>        <span class="hljs-type">double</span> mu = <span class="hljs-number">0.1</span>; <span class="hljs-comment">// friction coefficient</span><br><br>        std::cout&lt;&lt;<span class="hljs-string">&quot;--Init finished. Press ctrl c to exit--&quot;</span>&lt;&lt;std::endl;<br><br>        <span class="hljs-keyword">while</span>(!symc::SignalManager::<span class="hljs-built_in">ShouldExit</span>())&#123;<br>            robot.<span class="hljs-built_in">getPosition</span>(vpRobot::JOINT_STATE, q);<br>            robot.<span class="hljs-built_in">getVelocity</span>(vpRobot::JOINT_STATE, q_dot);<br>            robot.<span class="hljs-built_in">getMass</span>(B);<br>            robot.<span class="hljs-built_in">getCoriolis</span>(C);<br>            robot.<span class="hljs-built_in">getFriction</span>(F);<br>            robot.<span class="hljs-built_in">get_fJe</span>(fJe); <span class="hljs-comment">// get Jacobian matrix in joint space</span><br>            robot.<span class="hljs-built_in">getForceTorque</span>(vpRobot::JOINT_STATE, tau);<br>            <br>            fMed[<span class="hljs-number">1</span>][<span class="hljs-number">3</span>] = fMed0[<span class="hljs-number">1</span>][<span class="hljs-number">3</span>] + (sys_info.is_trajectory_started_ ? ( <span class="hljs-number">0.1</span> * <span class="hljs-built_in">sin</span>( <span class="hljs-number">2</span> * M_PI * <span class="hljs-number">0.3</span> * (sys_info.time_current_ - sys_info.time_start_trajectory_))) : <span class="hljs-number">0</span> );<br>            fMed[<span class="hljs-number">2</span>][<span class="hljs-number">3</span>] = fMed0[<span class="hljs-number">2</span>][<span class="hljs-number">3</span>] - (sys_info.is_trajectory_started_ ? ( <span class="hljs-number">0.05</span> * <span class="hljs-built_in">sin</span>( <span class="hljs-number">2</span> * M_PI * <span class="hljs-number">0.6</span> * (sys_info.time_current_ - sys_info.time_start_trajectory_))) : <span class="hljs-number">0</span>) ;<br>            x_dot_desired[<span class="hljs-number">1</span>] = (sys_info.is_trajectory_started_ ? (<span class="hljs-number">2</span> * M_PI * <span class="hljs-number">0.3</span> * <span class="hljs-number">0.1</span> * <span class="hljs-built_in">cos</span>( <span class="hljs-number">2</span> * M_PI * <span class="hljs-number">0.3</span> * (sys_info.time_current_ - sys_info.time_start_trajectory_))) : <span class="hljs-number">0</span>) ;<br>            x_dot_desired[<span class="hljs-number">2</span>] = (sys_info.is_trajectory_started_ ? (<span class="hljs-number">-2</span> * M_PI * <span class="hljs-number">0.6</span> * <span class="hljs-number">0.05</span> * <span class="hljs-built_in">cos</span>( <span class="hljs-number">2</span> * M_PI * <span class="hljs-number">0.6</span> * (sys_info.time_current_ - sys_info.time_start_trajectory_))) : <span class="hljs-number">0</span>) ;<br><br>            x_dot_dot_desired[<span class="hljs-number">1</span>] = (sys_info.is_trajectory_started_ ? (<span class="hljs-number">-2</span> * M_PI * <span class="hljs-number">0.3</span> * <span class="hljs-number">2</span> * M_PI * <span class="hljs-number">0.3</span> * <span class="hljs-number">0.1</span> * <span class="hljs-built_in">sin</span>( <span class="hljs-number">2</span> * M_PI * <span class="hljs-number">0.3</span> * (sys_info.time_current_ - sys_info.time_start_trajectory_))) : <span class="hljs-number">0</span>) ;<br>            x_dot_dot_desired[<span class="hljs-number">2</span>] = (sys_info.is_trajectory_started_ ? (<span class="hljs-number">2</span> * M_PI * <span class="hljs-number">0.6</span> * <span class="hljs-number">2</span> * M_PI * <span class="hljs-number">0.6</span> * <span class="hljs-number">0.05</span> * <span class="hljs-built_in">sin</span>( <span class="hljs-number">2</span> * M_PI * <span class="hljs-number">0.6</span> * (sys_info.time_current_ - sys_info.time_start_trajectory_))) : <span class="hljs-number">0</span>) ;<br><br>            edVf.<span class="hljs-built_in">insert</span>(fMed.<span class="hljs-built_in">getRotationMatrix</span>().<span class="hljs-built_in">t</span>(), <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>            edVf.<span class="hljs-built_in">insert</span>(fMed.<span class="hljs-built_in">getRotationMatrix</span>().<span class="hljs-built_in">t</span>(), <span class="hljs-number">3</span>, <span class="hljs-number">3</span>);<br>            <br><br>            fMe = robot.<span class="hljs-built_in">get_fMe</span>(); <span class="hljs-comment">// get end-effector pose</span><br>            vpPoseVector pose_error = <span class="hljs-built_in">static_cast</span>&lt;vpPoseVector&gt;(fMed.<span class="hljs-built_in">inverse</span>() * fMe);<br>            <br><br>            <span class="hljs-comment">// Lie algebra can transform between joint space and cartesian space</span><br>            vpMatrix La = symc::<span class="hljs-built_in">Ta</span>(pose_error); <span class="hljs-comment">// compute Lie algebra</span><br>            Ja = La*edVf*fJe; <span class="hljs-comment">// compute Jacobian matrix in cartesian space</span><br>            <span class="hljs-keyword">if</span>(!symc::<span class="hljs-built_in">IsEqual</span>(sys_info.dt_, <span class="hljs-number">0</span>))&#123;<br>                Ja_dot = (Ja - Ja_old) / sys_info.dt_;<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                Ja_dot = <span class="hljs-number">0</span>;<br>            &#125;<br>            Ja_old = Ja;<br>            <span class="hljs-comment">// weighted pseudo-inverse of the Jacobian matrix</span><br>            <span class="hljs-comment">// to optimize the control performance ?</span><br>            <span class="hljs-comment">// or to avoid singularity ?</span><br>            <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span>the formula is from the paper:</span><br>            Ja_pinv_B_t = (Ja * B.<span class="hljs-built_in">inverseByCholesky</span>()*Ja.<span class="hljs-built_in">t</span>()).<span class="hljs-built_in">inverseByCholesky</span>()*Ja*B.<span class="hljs-built_in">inverseByCholesky</span>();<br>            <br>            <span class="hljs-comment">// compute desired joint torque</span><br>            x_error = <span class="hljs-built_in">static_cast</span>&lt;vpColVector&gt;(pose_error); <span class="hljs-comment">// compute error in cartesian space</span><br>            x_dot_error = La*edVf*(x_dot_desired - fJe*q_dot); <span class="hljs-comment">// compute error in cartesian velocity</span><br>            <span class="hljs-comment">// formula: tau = M(q)*q_dot_dot + C(q,q_dot) + F(q_dot) + G(q)</span><br>            <span class="hljs-comment">// Ja.pseudoInverse is the inverse of the Jacobian matrix</span><br>            <span class="hljs-comment">// which can transform cartesian space to joint space</span><br>            vpMatrix control_law = (-K*(x_error)+D*(x_dot_error)-Ja_dot*q_dot + x_dot_dot_desired);<br>            tau_desired = B*Ja.<span class="hljs-built_in">pseudoInverse</span>()* control_law + C + F - (I7 - Ja.<span class="hljs-built_in">t</span>()*Ja_pinv_B_t)*B*q_dot*<span class="hljs-number">100</span>;<br>            <span class="hljs-keyword">if</span>(sys_info.is_first_)&#123;<br>                tau0 = tau_desired;<br>            &#125;<br>            tau_cmd = tau_desired - tau0*std::<span class="hljs-built_in">exp</span>(-mu*sys_info.time_current_ - sys_info.time_start_trajectory_);<br><br>            <span class="hljs-comment">// apply the desired joint torque</span><br>            robot.<span class="hljs-built_in">setForceTorque</span>(vpRobot::JOINT_STATE, tau_cmd);<br><br>            <span class="hljs-keyword">if</span>(opt_settings.verbose)&#123;<br>                std::cout&lt;&lt;<span class="hljs-string">&quot;dt: &quot;</span>&lt;&lt;sys_info.dt_&lt;&lt;std::endl;<br>            &#125;<br>            robot.<span class="hljs-built_in">wait</span>(sys_info.time_current_, <span class="hljs-number">0.001</span>); <span class="hljs-comment">// Sync loop at 1000 Hz (1 ms)</span><br>            sys_info.<span class="hljs-built_in">UpdateTime</span>(robot);<br>        &#125;<br>        symc::<span class="hljs-built_in">StopSimulation</span>(robot);<br>    &#125;<span class="hljs-built_in">catch</span>(<span class="hljs-type">const</span> vpException&amp; e)&#123;<br>        std::cout&lt;&lt;<span class="hljs-string">&quot;Catch an exception: &quot;</span>&lt;&lt;e.<span class="hljs-built_in">what</span>()&lt;&lt;std::endl;<br>        symc::<span class="hljs-built_in">StopSimulation</span>(robot);<br>        <span class="hljs-keyword">return</span> EXIT_FAILURE;<br>    &#125;<br>    std::cout&lt;&lt;<span class="hljs-string">&quot;--Exited--&quot;</span>&lt;&lt;std::endl;<br>    <span class="hljs-keyword">return</span> EXIT_SUCCESS;<br>&#125;<br></code></pre></td></tr></table></figure></p><h2 id="æ€»ç»“åŠæ¨å¯¼">æ€»ç»“åŠæ¨å¯¼</h2><h3 id="è¯´æ˜">è¯´æ˜</h3><p>è¿™é‡Œç›´æ¥è·³è¿‡ä¸å¤ªé‡è¦çš„éƒ¨åˆ†ï¼Œä»å­—é¢æ„æ€å³å¯ç†è§£å…¶ä½œç”¨ï¼Œé‡ç‚¹è¯´æ˜whileå¾ªç¯å†…çš„å†…å®¹ã€‚</p><ul><li><p>ä¸‹é¢ä»¥base frameæŒ‡ä»£åŸºåæ ‡ç³»ï¼ˆä½å§¿ï¼‰ï¼Œend-effectorframeæŒ‡ä»£æœ«ç«¯æ‰§è¡Œå™¨åæ ‡ç³»ï¼ˆä½å§¿ï¼‰ï¼Œå› ä¸ºHomogeneous TransformationMatrixæ—¢å¯ä»¥è¡¨ç¤ºå˜æ¢ä¹Ÿå¯ä»¥è¡¨ç¤ºä½å§¿ï¼Œæ‰€ä»¥åé¢å°±ä¸ç‰¹æ„è¯´æ˜æ˜¯ä½å§¿è¿˜æ˜¯å˜æ¢æ“ä½œäº†ã€‚</p></li><li><p>ç”¨task space(cartesianspace)æŒ‡ä»£ä»»åŠ¡ç©ºé—´ï¼ˆä¹Ÿå°±æ˜¯ç¬›å¡å°”ç©ºé—´ï¼‰ï¼Œç”¨jointspaceæŒ‡ä»£å…³èŠ‚ç©ºé—´ã€‚</p></li></ul><p>ä¸‹é¢é€è¡Œè¿›è¡Œè§£é‡Šã€‚</p><h3 id="åˆå§‹åŒ–">åˆå§‹åŒ–</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp">robot.<span class="hljs-built_in">getPosition</span>(vpRobot::JOINT_STATE, q);<br>robot.<span class="hljs-built_in">getVelocity</span>(vpRobot::JOINT_STATE, q_dot);<br>robot.<span class="hljs-built_in">getMass</span>(B);<br>robot.<span class="hljs-built_in">getCoriolis</span>(C);<br>robot.<span class="hljs-built_in">getFriction</span>(F);<br>robot.<span class="hljs-built_in">get_fJe</span>(fJe); <span class="hljs-comment">// get Jacobian matrix in joint space</span><br>robot.<span class="hljs-built_in">getForceTorque</span>(vpRobot::JOINT_STATE, tau);<br><br></code></pre></td></tr></table></figure><p>è¿™é‡Œé€šè¿‡è°ƒç”¨visp_rosçš„æ¥å£è·å–frankaçš„ä¿¡æ¯ï¼Œå…¶ä¸­ï¼š<br />* <em>getMass()</em>æŒ‡è·å–è´¨é‡çŸ©é˜µ(inertia matrix, æƒ¯æ€§çŸ©é˜µ)<br />* <em>getCoriolis()</em>æŒ‡è·å–ç§‘é‡Œå¥¥åˆ©åŠ›çŸ©é˜µ<br />* <em>getFriction()</em>æŒ‡è·å–æ‘©æ“¦åŠ›çŸ©é˜µ<br />* <em>get_fJe()</em>æŒ‡è·å–é›…å¯æ¯”çŸ©é˜µ(Jacobianmatrix)ï¼Œæ³¨æ„è¿™é‡Œæ˜¯å…³èŠ‚ç©ºé—´ä¸‹çš„é›…å¯æ¯”çŸ©é˜µ</p><p>å…¶ä»–æ ¹æ®å­—é¢æ„æ€ç†è§£å³å¯ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp">fMed[<span class="hljs-number">1</span>][<span class="hljs-number">3</span>] = fMed0[<span class="hljs-number">1</span>][<span class="hljs-number">3</span>] + (sys_info.is_trajectory_started_ ? ( <span class="hljs-number">0.1</span> * <span class="hljs-built_in">sin</span>( <span class="hljs-number">2</span> * M_PI * <span class="hljs-number">0.3</span> * (sys_info.time_current_ - sys_info.time_start_trajectory_))) : <span class="hljs-number">0</span> );<br>fMed[<span class="hljs-number">2</span>][<span class="hljs-number">3</span>] = fMed0[<span class="hljs-number">2</span>][<span class="hljs-number">3</span>] - (sys_info.is_trajectory_started_ ? ( <span class="hljs-number">0.05</span> * <span class="hljs-built_in">sin</span>( <span class="hljs-number">2</span> * M_PI * <span class="hljs-number">0.6</span> * (sys_info.time_current_ - sys_info.time_start_trajectory_))) : <span class="hljs-number">0</span>) ;<br>x_dot_desired[<span class="hljs-number">1</span>] = (sys_info.is_trajectory_started_ ? (<span class="hljs-number">2</span> * M_PI * <span class="hljs-number">0.3</span> * <span class="hljs-number">0.1</span> * <span class="hljs-built_in">cos</span>( <span class="hljs-number">2</span> * M_PI * <span class="hljs-number">0.3</span> * (sys_info.time_current_ - sys_info.time_start_trajectory_))) : <span class="hljs-number">0</span>) ;<br>x_dot_desired[<span class="hljs-number">2</span>] = (sys_info.is_trajectory_started_ ? (<span class="hljs-number">-2</span> * M_PI * <span class="hljs-number">0.6</span> * <span class="hljs-number">0.05</span> * <span class="hljs-built_in">cos</span>( <span class="hljs-number">2</span> * M_PI * <span class="hljs-number">0.6</span> * (sys_info.time_current_ - sys_info.time_start_trajectory_))) : <span class="hljs-number">0</span>) ;<br><br>x_dot_dot_desired[<span class="hljs-number">1</span>] = (sys_info.is_trajectory_started_ ? (<span class="hljs-number">-2</span> * M_PI * <span class="hljs-number">0.3</span> * <span class="hljs-number">2</span> * M_PI * <span class="hljs-number">0.3</span> * <span class="hljs-number">0.1</span> * <span class="hljs-built_in">sin</span>( <span class="hljs-number">2</span> * M_PI * <span class="hljs-number">0.3</span> * (sys_info.time_current_ - sys_info.time_start_trajectory_))) : <span class="hljs-number">0</span>) ;<br>x_dot_dot_desired[<span class="hljs-number">2</span>] = (sys_info.is_trajectory_started_ ? (<span class="hljs-number">2</span> * M_PI * <span class="hljs-number">0.6</span> * <span class="hljs-number">2</span> * M_PI * <span class="hljs-number">0.6</span> * <span class="hljs-number">0.05</span> * <span class="hljs-built_in">sin</span>( <span class="hljs-number">2</span> * M_PI * <span class="hljs-number">0.6</span> * (sys_info.time_current_ - sys_info.time_start_trajectory_))) : <span class="hljs-number">0</span>) ;<br><br></code></pre></td></tr></table></figure><p>è®¾å®šå‚è€ƒè½¨è¿¹ï¼Œä¹Ÿå°±æ˜¯ç›®æ ‡è½¨è¿¹ï¼ŒfMed,fMed0å‡æ˜¯<em>vpHomogeneousMatrix</em>ç±»å‹fMed[4][4]çš„indexå…ˆæ˜¯è¡Œå†æ˜¯åˆ—ï¼Œä¸çŸ©é˜µè¡¨ç¤ºä¹ æƒ¯ç›¸åŒã€‚<br />è¿™é‡Œè´´ä¸€ä¸‹<em>vpHomogeneousMatrix</em>ç±»å‹çš„éƒ¨åˆ†æºç æ³¨é‡Šï¼š</p><p>The class provides a data structure for the homogeneous matrices aswell as a set of operations on these matrices.</p><p>The vpHomogeneousMatrix class is derived from vpArray2D<double>.</p><p>An homogeneous matrix is 4x4 matrix defines as <spanclass="math display">\[\left[^a{\bf M}_b = \left(\begin{array}{cc}^a{\bf R}_b &amp; ^a{\bf t}_b \\{\bf 0}_{1\times 3} &amp; 1\end{array}\right)\right]\]</span><br />that defines the position of frame <em>b</em> in frame <em>a</em></p><p>$ ^a{R}_b$ is a rotation matrix and $ ^a{t}_b$ is a translationvector.</p><h3 id="çŸ©é˜µæ›´æ–°">çŸ©é˜µæ›´æ–°</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp">edVf.<span class="hljs-built_in">insert</span>(fMed.<span class="hljs-built_in">getRotationMatrix</span>().<span class="hljs-built_in">t</span>(), <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>edVf.<span class="hljs-built_in">insert</span>(fMed.<span class="hljs-built_in">getRotationMatrix</span>().<span class="hljs-built_in">t</span>(), <span class="hljs-number">3</span>, <span class="hljs-number">3</span>);<br></code></pre></td></tr></table></figure><p>TODO:è¿™ä¸ªæ²¡æ‡‚æ˜¯å¹²å•¥çš„ï¼Œåé¢å¾…è¡¥å……ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp">fMe = robot.<span class="hljs-built_in">get_fMe</span>(); <span class="hljs-comment">// get end-effector pose</span><br>vpPoseVector pose_error = <span class="hljs-built_in">static_cast</span>&lt;vpPoseVector&gt;(fMed.<span class="hljs-built_in">inverse</span>() * fMe); <span class="hljs-comment">// get error in cartesian space</span><br></code></pre></td></tr></table></figure><p>é€šè¿‡ <em>get_fMe()</em> è·å–frankaçš„å§¿æ€(Homogeneous transformationmatrix)ï¼Œç„¶åè®¡ç®—ä¸ç›®æ ‡ä½å§¿çš„è¯¯å·®ï¼ŒfMedæ˜¯ä¸Šé¢è®¾ç½®çš„ç›®æ ‡ä½å§¿ã€‚<br />ä¸ºä»€ä¹ˆ <em>fMed.inverse() * fMe</em>å¾—åˆ°çš„å°±æ˜¯ä½å§¿è¯¯å·®ï¼Ÿè¿™é‡Œæˆ‘çš„ç†è§£æ˜¯fMedçš„å½¢å¼åº”è¯¥æ˜¯<spanclass="math inline">\(^{B}T_{D}\)</span>(ç›®æ ‡ä½å§¿ç›¸å¯¹åŸºåæ ‡ç³»)ï¼ŒfMeçš„å½¢å¼<spanclass="math inline">\({B}T_{E}\)</span>(æœ«ç«¯æ‰§è¡Œå™¨ä½å§¿ç›¸å¯¹åŸºåæ ‡ç³»)ï¼Œé€šè¿‡å·¦ä¹˜å˜æ¢çŸ©é˜µå°†fMeè½¬æ¢åˆ°ç›®æ ‡åæ ‡ç³»ä¸‹ï¼Œå³æœ«ç«¯æ‰§è¡Œå™¨ç›¸å¯¹ç›®æ ‡åæ ‡ç³»çš„ä½å§¿è¡¨ç¤ºï¼Œå¾—åˆ°çš„å³æ˜¯ä½å§¿è¯¯å·®ã€‚//TODO:è¿™é‡Œç†è§£å¯èƒ½æ˜¯é”™è¯¯çš„</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// Lie algebra can transform between joint space and cartesian space</span><br>vpMatrix La = symc::<span class="hljs-built_in">Ta</span>(pose_error); <span class="hljs-comment">// compute Lie algebra</span><br>Ja = La*edVf*fJe; <span class="hljs-comment">// compute Jacobian matrix in cartesian space</span><br><span class="hljs-keyword">if</span>(!symc::<span class="hljs-built_in">IsEqual</span>(sys_info.dt_, <span class="hljs-number">0</span>))&#123;<br>    Ja_dot = (Ja - Ja_old) / sys_info.dt_;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    Ja_dot = <span class="hljs-number">0</span>;<br>&#125;<br>Ja_old = Ja;<br></code></pre></td></tr></table></figure><p>é€šè¿‡ <em>Ta</em> å‡½æ•°è¾“å…¥çš„é½æ¬¡å˜æ¢çŸ©é˜µedMeï¼ˆä»£è¡¨æœ«ç«¯æ‰§è¡Œå™¨ä½å§¿ï¼‰ï¼Œè®¡ç®—æä»£æ•°ï¼Œæä»£æ•°æ˜¯ç”¨æ¥è¡¨ç¤ºå˜æ¢ç¾¤ï¼ˆå¦‚SO(3)å’ŒSE(3)ï¼‰çš„æ— ç©·å°å˜æ¢ï¼ˆå³å¾®åˆ†å½¢å¼ï¼‰ã€‚è¿”å›çš„æ˜¯6x6 çš„æä»£æ•°çŸ©é˜µï¼Œå®ƒè¡¨ç¤ºäº†å½“å‰æœ«ç«¯æ‰§è¡Œå™¨ä½å§¿å¯¹åº”çš„å¾®åˆ†å˜æ¢ã€‚<br /><strong>å®ƒçš„ä½œç”¨æ˜¯ç”¨äºå°†6ç»´çš„åˆšä½“è¿åŠ¨ï¼ˆé€Ÿåº¦ã€åŠ›ï¼‰ä»ä¸€ä¸ªåæ ‡ç³»è½¬æ¢åˆ°å¦ä¸€ä¸ªåæ ‡ç³»</strong><br />ç„¶åè®¡ç®—é›…å¯æ¯”çŸ©é˜µï¼ˆJaï¼‰ï¼Œ<strong>æ³¨æ„fJeæ˜¯ä¸Šé¢è·å–çš„å…³èŠ‚ç©ºé—´ä¸‹çš„é›…å¯æ¯”çŸ©é˜µ</strong>ï¼Œé€šè¿‡å·¦ä¹˜La*edVfå°†å…¶è½¬æ¢åˆ°ç¬›å¡å°”ç©ºé—´ä¸‹ï¼Œå¾—åˆ°ç¬›å¡å°”ç©ºé—´ä¸‹çš„é›…å¯æ¯”çŸ©é˜µJaã€‚<br /><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// weighted pseudo-inverse of the Jacobian matrix</span><br><span class="hljs-comment">// to optimize the control performance ?</span><br><span class="hljs-comment">// or to avoid singularity ?</span><br><span class="hljs-comment">// <span class="hljs-doctag">TODO:</span>the formula is from the paper:</span><br>Ja_pinv_B_t = (Ja * B.<span class="hljs-built_in">inverseByCholesky</span>()*Ja.<span class="hljs-built_in">t</span>()).<span class="hljs-built_in">inverseByCholesky</span>()*Ja*B.<span class="hljs-built_in">inverseByCholesky</span>();<br></code></pre></td></tr></table></figure></p><p>æ²¡çœ‹æ‡‚ï¼Œæ ¹æ®chatgptçš„è¯´æ³•ï¼ŒJa_pinv_B_tæ˜¯åŠ æƒä¼ªé€†é›…å¯æ¯”çŸ©é˜µï¼Œå…¶å…¬å¼å°±æ˜¯ï¼š<br /><span class="math display">\[Ja\_pinv\_B\_t=(Ja \cdot {B^{âˆ’1}}\cdotJa^{T})^{-1}\cdot Ja\cdot B^{-1}\]</span><br />è´´ä¸€ä¸‹å®ƒçš„è§£é‡Šï¼š<br />è¿™ä¸ªè¡¨è¾¾å¼ Ja_pinv_B_t æ˜¯è®¡ç®— åŠ æƒä¼ªé€†é›…å¯æ¯”çŸ©é˜µçš„ä¸€ç§æ–¹å¼ã€‚åŠ æƒä¼ªé€†ï¼ˆweightedpseudoinverseï¼‰æ˜¯ç”¨äºè§£å†³æ¬ å®šæˆ–è¶…å®šç³»ç»Ÿä¸­çš„ä¼ªé€†è¿ç®—ï¼Œå…¶ä¸­çŸ©é˜µä¸ä¸€å®šæ˜¯æ–¹é˜µï¼Œä¸”éœ€è¦è€ƒè™‘ç‰¹å®šæƒé‡ã€‚<br />ä¼ªé€†é›…å¯æ¯”çŸ©é˜µåœ¨æ§åˆ¶å’Œè¿åŠ¨å­¦ä¸­ç”¨äºæ±‚è§£æ¬ å®šæˆ–å†—ä½™ç³»ç»Ÿçš„é€†è¿åŠ¨å­¦é—®é¢˜ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒåŠ æƒä¼ªé€†é€šè¿‡çŸ©é˜µé€šè¿‡çŸ©é˜µBå¼•å…¥äº†æƒé‡ï¼Œä½¿å¾—è§£ç©ºé—´èƒ½å¤Ÿæ ¹æ®ç‰¹å®šçš„æƒé‡è¿›è¡Œä¼˜åŒ–ã€‚<br />åŠ æƒä¼ªé€†çš„å¸¸è§åº”ç”¨ï¼š<br />* å…³èŠ‚ç©ºé—´ä¸­çš„ä¼˜åŒ–æ§åˆ¶ã€‚<br />* å¤„ç†æœºå™¨äººå†—ä½™åº¦æ—¶å¹³è¡¡å…³èŠ‚çš„ä¸åŒèƒ½é‡æ¶ˆè€—æˆ–é™åˆ¶ã€‚<br />* æœ€å°åŒ–åœ¨ä»»åŠ¡ç©ºé—´ä¸­å®ç°è¿åŠ¨æ—¶ï¼Œå…³èŠ‚ç©ºé—´ä¸­çš„åŠ›æˆ–é€Ÿåº¦ã€‚</p><p>è¯¥è¡¨è¾¾å¼é€šè¿‡Choleskyåˆ†è§£è®¡ç®—äº†åŠ æƒä¼ªé€†é›…å¯æ¯”çŸ©é˜µã€‚å…¶ç›®çš„æ˜¯ï¼š<br />* åˆ©ç”¨çŸ©é˜µğµå¯¹é›…å¯æ¯”çŸ©é˜µè¿›è¡ŒåŠ æƒï¼Œä¼˜åŒ–è¿åŠ¨æ§åˆ¶æˆ–å†—ä½™åº¦å¤„ç†ã€‚<br />* ä½¿ç”¨Choleskyåˆ†è§£æå‡äº†è®¡ç®—æ•ˆç‡ï¼Œé€‚ç”¨äºæ­£å®šå¯¹ç§°çŸ©é˜µğµçš„æƒ…å¢ƒã€‚</p><p>æœ€ç»ˆï¼ŒJa_pinv_B_tæ˜¯é›…å¯æ¯”çŸ©é˜µçš„åŠ æƒä¼ªé€†ï¼Œå®ƒåœ¨æœºå™¨äººæ§åˆ¶å’Œè¿åŠ¨å­¦æ±‚è§£ä¸­ç”¨äºä¼˜åŒ–å’Œè§£å†³æ¬ å®šæˆ–å†—ä½™é—®é¢˜ã€‚</p><h3 id="è®¡ç®—æ§åˆ¶å¾‹">è®¡ç®—æ§åˆ¶å¾‹</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// compute desired joint torque</span><br>x_error = <span class="hljs-built_in">static_cast</span>&lt;vpColVector&gt;(pose_error); <span class="hljs-comment">// compute error in cartesian space</span><br>x_dot_error = La*edVf*(x_dot_desired - fJe*q_dot); <span class="hljs-comment">// compute error in cartesian velocity</span><br></code></pre></td></tr></table></figure><p>åœ¨ç¬›å¡å°”ç©ºé—´è®¡ç®—ä½ç½®å§¿æ€è¯¯å·®å’Œé€Ÿåº¦è¯¯å·®ã€‚<br /><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">vpMatrix control_law = (-K*(x_error)+D*(x_dot_error)-Ja_dot*q_dot + x_dot_dot_desired);<br></code></pre></td></tr></table></figure> é€šè¿‡é˜»æŠ—æ§åˆ¶è®¡ç®—æ§åˆ¶å¾‹ã€‚<br />Ké¡¹ä¸ºåˆšåº¦æ§åˆ¶é¡¹ï¼Œå¯¹ä½ç½®è¯¯å·®æ–½åŠ æ¢å¤åŠ›ï¼Œç±»ä¼¼äºå¼¹ç°§çš„ä½œç”¨ï¼Œæ¨åŠ¨æœºå™¨äººå›åˆ°æœŸæœ›ä½ç½®ã€‚<br />Dé¡¹é˜»å°¼æ§åˆ¶é¡¹ï¼Œåˆ©ç”¨é€Ÿåº¦è¯¯å·®æ¥å¢åŠ é˜»å°¼ï¼ŒæŠ‘åˆ¶æŒ¯è¡å’Œä¸ç¨³å®šè¡Œä¸ºã€‚<br />-Ja_dot*q_doté›…å¯æ¯”çŸ©é˜µçš„å˜åŒ–å½±å“é¡¹ï¼Œè€ƒè™‘äº†æœºå™¨äººå…³èŠ‚é€Ÿåº¦å’Œé›…å¯æ¯”çŸ©é˜µéšæ—¶é—´å˜åŒ–çš„è€¦åˆæ•ˆåº”ã€‚<br />x_dot_dot_desiredæœŸæœ›åŠ é€Ÿåº¦ï¼Œç›´æ¥ç»™å‡ºç³»ç»Ÿåº”è¯¥è¾¾åˆ°çš„åŠ é€Ÿåº¦ç›®æ ‡ã€‚<br /><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// formula: tau = M(q)*q_dot_dot + C(q,q_dot) + F(q_dot) + G(q)</span><br><span class="hljs-comment">// Ja.pseudoInverse is the inverse of the Jacobian matrix</span><br><span class="hljs-comment">// which can transform cartesian space to joint space</span><br>tau_desired = B*Ja.<span class="hljs-built_in">pseudoInverse</span>()* control_law + C + F - (I7 - Ja.<span class="hljs-built_in">t</span>()*Ja_pinv_B_t)*B*q_dot*<span class="hljs-number">100</span>;<br></code></pre></td></tr></table></figure> è®¡ç®—æœŸæœ›åŠ›çŸ©ï¼Œå…¶å…¬å¼ä¸ºï¼š<br /><span class="math display">\[\tau = M(q)\cdot \ddot{q} + C(q,\dot{q}) +F(\dot{q}) + G(q)\]</span><br />control_lawå·¦ä¹˜ <em>Ja.pseudoInverse()</em>æ˜¯å°†control_lawä»ç¬›å¡å°”ç©ºé—´è½¬æ¢åˆ°ä»»åŠ¡ç©ºé—´ã€‚<br />åé¢çš„-(I7 -Ja.t()*Ja_pinv_B_t)*B*q_dot*100æ ¹æ®chatgptçš„è§£é‡Šæ˜¯è¯¯å·®æ ¡æ­£é¡¹ï¼Œæ²¡çœ‹æ‡‚ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp">tau_cmd = tau_desired - tau0*std::<span class="hljs-built_in">exp</span>(-mu*sys_info.time_current_ - sys_info.time_start_trajectory_);<br><span class="hljs-comment">// apply the desired joint torque</span><br>robot.<span class="hljs-built_in">setForceTorque</span>(vpRobot::JOINT_STATE, tau_cmd);<br></code></pre></td></tr></table></figure><p>è®¡ç®—çœŸæ­£çš„æ§åˆ¶åŠ›çŸ©tau_cmdï¼Œåé¢åŠ ä¸ŠexpæŒ‡æ•°é¡¹æ˜¯ä¸ºäº†åœ¨å¯åŠ¨æ—¶æ§åˆ¶åŠ›çŸ©æ˜¯å…‰æ»‘çš„ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ§åˆ¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ä»¿çœŸ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Rotation Matrix</title>
    <link href="/2024/09/05/Rotation-Matrix/"/>
    <url>/2024/09/05/Rotation-Matrix/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h2 id="æ€§è´¨å’Œç»“è®º">æ€§è´¨å’Œç»“è®º</h2><p><strong>ä»B frameç›¸å¯¹äºA frameçš„æ—‹è½¬çŸ©é˜µçš„è½¬ç½®å³ä¸ºA frameç›¸å¯¹äºBframeçš„æ—‹è½¬çŸ©é˜µï¼ŒåŒæ—¶ç­‰äºå…¶é€†çŸ©é˜µï¼š</strong> <spanclass="math display">\[^{A}_{B}R = ^{B}_{A}A^{T}=^{B}_{A}A^{-1}\]</span><strong>æ—‹è½¬çŸ©é˜µå¯ä»¥å°†ä¸€ä¸ªç‚¹(P)ä»ä¸€ä¸ªframe(B)å˜æ¢åˆ°å¦ä¸€ä¸ªframe(A)ï¼š</strong><span class="math display">\[^{A}P=^{A}_{B}R \cdot ^{B}P\]</span><strong>ç”¨åæ ‡è½´ç»•å‚è€ƒåæ ‡ç³»æ—‹è½¬è§’åº¦æ¥ç¡®å®šæ—‹è½¬çŸ©é˜µï¼š</strong> <spanclass="math display">\[R_{Z_{A}}({\theta})=\left[\begin{matrix}cos{\theta} &amp; -sin\theta &amp; 0 \\ sin{\theta} &amp; cos{\theta}&amp; 0 \\ 0 &amp; 0 &amp; 1 \end{matrix}\right]=\left[\begin{matrix}c{\theta} &amp; -s\theta &amp; 0 \\ s{\theta} &amp; c{\theta} &amp; 0 \\0 &amp; 0 &amp; 1 \end{matrix}\right]\]</span> <spanclass="math display">\[R_{X_{A}}({\theta})=\left[\begin{matrix} 1 &amp;0 &amp; 0 \\ 0 &amp; cos{\theta} &amp; -sin{\theta} \\ 0 &amp;sin{\theta} &amp; cos{\theta} \end{matrix}\right]=\left[\begin{matrix} 1&amp; 0 &amp; 0 \\ 0 &amp; c{\theta} &amp; -s{\theta} \\ 0 &amp;s{\theta} &amp; c{\theta} \end{matrix}\right]\]</span> <spanclass="math display">\[R_{Y_{A}}({\theta})=\left[\begin{matrix}cos{\theta} &amp; 0 &amp; sin{\theta} \\ 0 &amp; 1 &amp; 0 \\-sin{\theta} &amp; 0 &amp; cos{\theta}\end{matrix}\right]=\left[\begin{matrix} c{\theta} &amp; 0 &amp;s{\theta} \\ 0 &amp; 1 &amp; 0 \\ -s{\theta} &amp; 0 &amp; c{\theta}\end{matrix}\right]\]</span> <em>Aè¡¨ç¤ºAframeï¼Œå‚è€ƒåæ ‡ç³»ï¼Œå³ä¸–ç•Œåæ ‡ç³»ï¼ŒBè¡¨ç¤ºBodyframeï¼Œæœ¬åœ°åæ ‡ç³»ï¼Œå³ç‰©ä½“åæ ‡ç³»ã€‚</em></p><p><strong>æè¿°ä¸€ä¸ªframe(B)ç›¸å¯¹å¦ä¸€ä¸ªframe(A)çš„å§¿æ€ï¼š</strong> <spanclass="math display">\[^{A}_{B}R=\left[\begin{matrix} | &amp; | &amp; |\\ ^{A}X_{B} &amp; ^{A}Y_{B} &amp; ^{A}Z_{B} \\ | &amp; | &amp; |\end{matrix}\right]\]</span> <em>å…¶ä¸­<spanclass="math inline">\(^{A}X_{B}\)</span>ï¼Œ<spanclass="math inline">\(^{A}Y_{B}\)</span>ï¼Œ<spanclass="math inline">\(^{A}Z_{B}\)</span>åˆ†åˆ«ä»£è¡¨B frameå„åæ ‡è½´åœ¨AframeæŠ•å½±çš„åˆ—å‘é‡ã€‚</em></p><h2 id="fixed-angles">Fixed Angles</h2><p><strong>é’ˆå¯¹ç©ºé—´ä¸­å›ºå®šçš„åæ ‡ç³»XYZè¿›è¡Œæ—‹è½¬æ“ä½œï¼š</strong> <spanclass="math display">\[^{A}_{B}R_{XYZ}(\gamma,\beta,\alpha)=R_{Z}(\alpha)R_{Y}(\beta)R_{X}(\gamma)\]</span><span class="math display">\[=\left[\begin{matrix} c{\alpha} &amp;-s\alpha &amp; 0 \\ s{\alpha} &amp; c{\alpha} &amp; 0 \\ 0 &amp; 0 &amp;1 \end{matrix}\right]\left[\begin{matrix} c{\beta} &amp; 0 &amp;s{\beta} \\ 0 &amp; 1 &amp; 0 \\ -s{\beta} &amp; 0 &amp; c{\beta}\end{matrix}\right]\left[\begin{matrix} 1 &amp; 0 &amp; 0 \\ 0 &amp;c{\gamma} &amp; -s{\gamma} \\ 0 &amp; s{\gamma} &amp; c{\gamma}\end{matrix}\right]\]</span> <spanclass="math display">\[=\left[\begin{matrix}c{\alpha}c{\beta} &amp;c{\alpha}s{\beta}s{\gamma}-s{\alpha}c{\gamma} &amp;c{\alpha}s{\beta}c{\gamma}+s{\alpha}s{\gamma} \\ s{\alpha}c{\beta} &amp;s{\alpha}s{\beta}s{\gamma}+c{\alpha}c{\gamma} &amp;s{\alpha}s{\beta}c{\gamma}-c{\alpha}s{\gamma}  \\-s{\beta} &amp;c{\beta}s{\gamma} &amp;c{\beta}c{\gamma}\end{matrix}\right]=\left[\begin{matrix}r_{11} &amp;r_{12} &amp; r_{13} \\ r_{21} &amp; r_{22} &amp; r_{23} \\ r_{31} &amp;r_{32} &amp; r_{33}\end{matrix}\right]\]</span></p><p><em>å…ˆè½¬çš„æ”¾åœ¨åé¢ï¼Œè½¬åŠ¨çš„é¡ºåºï¼ˆå·¦ä¹˜ï¼‰æ˜¯ä¸èƒ½äº’æ¢çš„ã€‚</em></p><p><strong>é€šè¿‡Ræ¨ç®—Anglesï¼š</strong> <spanclass="math display">\[^{A}_{B}R_{XYZ}(\gamma,\beta,\alpha)=\left[\begin{matrix}c{\alpha}c{\beta}&amp; c{\alpha}s{\beta}s{\gamma}-s{\alpha}c{\gamma} &amp;c{\alpha}s{\beta}c{\gamma}+s{\alpha}s{\gamma} \\ s{\alpha}c{\beta} &amp;s{\alpha}s{\beta}s{\gamma}+c{\alpha}c{\gamma} &amp;s{\alpha}s{\beta}c{\gamma}-c{\alpha}s{\gamma}  \\-s{\beta} &amp;c{\beta}s{\gamma} &amp;c{\beta}c{\gamma}\end{matrix}\right]=\left[\begin{matrix}r_{11} &amp;r_{12} &amp; r_{13} \\ r_{21} &amp; r_{22} &amp; r_{23} \\ r_{31} &amp;r_{32} &amp; r_{33}\end{matrix}\right]\]</span> <spanclass="math inline">\(if\space{\beta} \neq 90^{\circ}\)</span> <spanclass="math display">\[\beta=Atan2(-r_{31},\sqrt{r_{11}^2+r_{21}^2})\]</span><spanclass="math display">\[\alpha=Atan2(\frac{r_{21}}{c{\beta}},\frac{r_{11}}{c{\beta}})\]</span><spanclass="math display">\[\gamma=Atan2(\frac{r_{32}}{c{\beta}},\frac{r_{33}}{c{\beta}})\]</span><span class="math inline">\(if \space \beta=90^{\circ}\)</span> <spanclass="math display">\[\alpha=0^{\circ}\]</span> <spanclass="math display">\[\gamma=Atan2(r_{12},r_{22})\]</span> <spanclass="math inline">\(if \space \beta=-90^{\circ}\)</span> <spanclass="math display">\[\alpha=0^{\circ}\]</span> <spanclass="math display">\[\gamma=-Atan2(r_{12},r_{22})\]</span></p><h2 id="euler-angles">Euler Angles</h2><p><strong>Z-Y-X</strong> <spanclass="math display">\[^{A}_{B}R_{Z^{&#39;}Y^{&#39;}X^{&#39;}}(\alpha,\beta,\gamma)=^{A}_{B^{&#39;}}R^{B^{&#39;}}_{B^{&#39;&#39;}}R^{B^{&#39;&#39;}}_{B}R=R_{Z^{&#39;}}(\alpha)R_{Y^{&#39;}}(\beta)R_{X^{&#39;}}(\gamma)\]</span><em>å…ˆè½¬çš„æ”¾åœ¨å‰é¢ï¼Œè½¬åŠ¨çš„é¡ºåºï¼ˆå·¦ä¹˜ï¼‰æ˜¯ä¸èƒ½äº’æ¢çš„ã€‚</em> <em>å¯¹FixedAngleä»¥XYZçš„é¡ºåºè½¬åŠ¨ï¼Œç›¸å½“äºå¯¹Euler Angleä»¥ZYXçš„é¡ºåºè½¬åŠ¨ã€‚</em><em>Euler Angleçš„æ­£è½¬å’ŒFixed Angleçš„åè½¬ä¼šå¾—åˆ°ç›¸åŒçš„è§£ã€‚</em></p><h2 id="åˆšä½“çŠ¶æ€çš„è¡¨è¾¾">åˆšä½“çŠ¶æ€çš„è¡¨è¾¾</h2><p><strong>Homogeneous transformation matrix (4x4):</strong> <spanclass="math display">\[^{A}_{B}T=\left[\begin{matrix}^{A}_{B}R_{3\times3}&amp; ^{A}P_{B_{org}3\times1} \\ 0_{1\times3} &amp;1\end{matrix}\right]\]</span> <spanclass="math display">\[=\left[\begin{matrix} | &amp; | &amp; | &amp; |\\ ^{A}X_{B} &amp; ^{A}Y_{B} &amp; ^{A}Z_{B} &amp; P_{B_{org}} \\ |&amp; | &amp; | &amp; | \\ 0 &amp; 0 &amp; 0 &amp; 1\end{matrix}\right]\]</span><em>å·¦ä¸Šè§’ä¸ºæ—‹è½¬çŸ©é˜µï¼Œå³ä¸Šè§’ä¸ºç§»åŠ¨çŠ¶æ€ã€‚</em></p><p><strong>ç§»åŠ¨å’Œè½¬åŠ¨å¤åˆè¿ç®—ï¼š</strong> <spanclass="math display">\[^{A}P_{3\times1}=^{A}_{B}R^{B}P_{3\times1}+^{A}P_{B_{org}3\times1}\]</span><span class="math display">\[\left[\begin{matrix}^{A}P \\1\end{matrix}\right]=^{A}_{B}T\left[\begin{matrix}^{B}P \\1\end{matrix}\right]\]</span></p><p><strong>å¯è¿ç»­æ“ä½œï¼š</strong> <spanclass="math display">\[^{A}_{B}T=^{A}_{C}T^{C}_{D}T^{D}_{B}T\]</span><em>"sequential transformation"</em></p><p><strong>Mapping and Operator:</strong></p><p>transformationmatrixæ—¢æœ‰Mappingï¼ˆæŠŠå‘é‡ä»ä¸€ä¸ªframeè½¬æ¢åˆ°å¦ä¸€ä¸ªframeä¸‹æ¥çœ‹ï¼‰çš„åŠŸèƒ½ä¹Ÿå¯å½“ä½œOperatorå¯¹å‘é‡ï¼ˆæˆ–ç‚¹ï¼‰è¿›è¡Œç§»åŠ¨æˆ–æ—‹è½¬ï¼ˆåœ¨åŒä¸€ä¸ªframeï¼‰ã€‚</p><p><span class="math display">\[\left[\begin{matrix}^{A}P_2 \\1\end{matrix}\right]=T\left[\begin{matrix}^{A}P_1 \\1\end{matrix}\right]\]</span></p><h2 id="homogeneous-transformation-matrixçš„ä¸‰ç§ç”¨æ³•">Homogeneoustransformation matrixçš„ä¸‰ç§ç”¨æ³•</h2><ol type="1"><li>æè¿°ä¸€ä¸ªframeï¼ˆç›¸å¯¹äºå¦ä¸€ä¸ªframeï¼‰çš„ç©ºé—´çŠ¶æ€ã€‚ <spanclass="math display">\[^{A}_{B}T=\left[\begin{matrix} | &amp; | &amp; |&amp; | \\ ^{A}X_{B} &amp; ^{A}Y_{B} &amp; ^{A}Z_{B} &amp; P_{B_{org}}\\ | &amp; | &amp; | &amp; | \\ 0 &amp; 0 &amp; 0 &amp; 1\end{matrix}\right]\]</span></li><li>å°†pointç”±æŸä¸€ä¸ªframeçš„è¡¨è¾¾è½¬æ¢åˆ°å¦ä¸€ä¸ªframeæ¥è¡¨è¾¾ã€‚ <spanclass="math display">\[\left[\begin{matrix}^{A}P \\1\end{matrix}\right]=^{A}_{B}T\left[\begin{matrix}^{B}P \\1\end{matrix}\right]\]</span></li><li>å°†point(vector)åœ¨åŒä¸€ä¸ªframeä¸­è¿›è¡Œç§»åŠ¨å’Œè½¬åŠ¨ã€‚ <spanclass="math display">\[\left[\begin{matrix}^{A}P_2 \\1\end{matrix}\right]=T\left[\begin{matrix}^{A}P_1 \\1\end{matrix}\right]\]</span></li></ol><h2 id="transformation-matrixè¿ç®—">Transformation Matrixè¿ç®—</h2><p><strong>é€†çŸ©é˜µï¼š</strong></p><p><spanclass="math display">\[^{A}_{B}T^{B}_{A}T=^{A}_{B}T^{A}_{B}T^{-1}=I_{4\times4}\]</span></p><p><spanclass="math display">\[^{A}_{B}T^{-1}=\left[\begin{matrix}^{A}_{B}R^{T}&amp; -^{A}_{B}{R^{T}}^{A}P_{B_{org}} \\ 0_{1\times3} &amp;1\end{matrix}\right]\]</span> <strong>è¿ç»­è¿ç®—æ³•åˆ™ï¼š</strong></p><ol type="1"><li>{B}å¯¹{A}çš„è½¬è½´æ—‹è½¬ï¼šç”¨"premultiply"ï¼Œå…ˆè½¬çš„æ”¾åœ¨åé¢</li><li>{B}å¯¹{B}è‡ªèº«çš„è½¬è½´æ—‹è½¬ï¼šç”¨"postmultiply"ï¼Œå…ˆè½¬çš„æ”¾åœ¨å‰é¢</li></ol><h2 id="links">links</h2><p><a href="https://www.coursera.org/learn/robotics1">æ©Ÿå™¨äººå­¸ä¸€(Robotics (1))</a></p>]]></content>
    
    
    <categories>
      
      <category>æ§åˆ¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç†è®º</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CLF-CBF</title>
    <link href="/2024/09/04/CLF-CBF/"/>
    <url>/2024/09/04/CLF-CBF/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h2id="åŠ¨æ€æ§åˆ¶ä»¿å°„ç³»ç»Ÿdynamics-control-affine-system">1.åŠ¨æ€æ§åˆ¶ä»¿å°„ç³»ç»Ÿ(DynamicsControl Affine System)</h2><p>å¯¹äº<span class="math inline">\(\dot{x} =F(t,x,u)\)</span>ï¼Œå…¶ä¸­ç³»ç»ŸçŠ¶æ€<spanclass="math inline">\(x\in{\mathbb{R}^n}\)</span>ï¼Œç³»ç»Ÿè¾“å…¥<spanclass="math inline">\(u \in{\mathbb{R}^m}\)</span>ï¼Œå¦‚æœ<spanclass="math inline">\(F\)</span>å¯¹äº<spanclass="math inline">\(x\)</span>å’Œ<spanclass="math inline">\(u\)</span>æ˜¯Lipschitzè¿ç»­çš„ï¼Œæ—¶é—´<spanclass="math inline">\(t\)</span>æ˜¯piecewiseè¿ç»­çš„ï¼Œé‚£ä¹ˆåœ¨ç»™å®šçš„åˆå§‹æ¡ä»¶<spanclass="math inline">\(x_0\)</span>ä¸‹ï¼Œè½¨è¿¹<spanclass="math inline">\(x(t)\)</span>æ˜¯å­˜åœ¨å¹¶ä¸”uniqueçš„ã€‚</p><p>ä¸€èˆ¬å†™æˆå¦‚ä¸‹å½¢å¼ï¼š</p><p><span class="math display">\[\dot{x} = f(x) + g(x)u\]</span></p><p>å…¶ä¸­<spanclass="math inline">\(f:\mathbb{R}^n\rightarrow{\mathbb{R}^n},g:\mathbb{R}^n\rightarrow{\mathbb{R}^{n*m}}\)</span>ï¼Œ<spanclass="math inline">\(x\)</span>æ˜¯Lipschitzè¿ç»­ï¼Œ<spanclass="math inline">\(x_e = 0\)</span>ã€‚</p><h2 id="clfcontrol-lyapunov-function">2.CLF(Control LyapunovFunction)</h2><p>Lyapunove Functionæ•°å­¦å®šä¹‰å¦‚ä¸‹ï¼š</p><p><span class="math display">\[V(x)\]</span> <spanclass="math display">\[s.t. V(x_e) = 0, V(x) &gt; 0 \ for \ x \neqx_e\]</span> <span class="math display">\[\dot{V(x)} = \frac{\partialV}{\partial x}f(x) &lt; 0 \ for \ x \neq x_e\]</span></p><p><spanclass="math inline">\(V(x)\)</span>æ˜¯å®šä¹‰çš„Lyapunovå‡½æ•°ï¼Œä¸‹é¢çš„æ˜¯çº¦æŸæ¡ä»¶ï¼Œå½“æ»¡è¶³ä¸Šè¿°ä¸¤ä¸ªçº¦æŸæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºxæ¸è¿‘ç¨³å®šã€‚</p><p>å°†è¾“å…¥<span class="math inline">\(u\)</span>å¼•å…¥åˆ°LyapunoveFunctionï¼Œå¾—åˆ°æ–°çš„æ–¹ç¨‹ã€‚ ä½¿<spanclass="math inline">\(V(x):\mathbb{R}^n\rightarrow{\mathbb{R}}\)</span>æ˜¯è¿ç»­Differentialå‡½æ•°ï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªå¸¸æ•°<spanclass="math inline">\(c&gt;0\)</span>ä½¿å¾—<spanclass="math inline">\(V(x)\)</span>æ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼Œé‚£ä¹ˆ<spanclass="math inline">\(V(x)\)</span>å°±æ˜¯ä¸€ä¸ªå…³äº<spanclass="math inline">\(x\)</span>çš„Control Lyapunov Functionã€‚</p><p><span class="math inline">\(1)\ \Omega := \{x\in{\mathbb{R}^n}:V(x)\le{c}\}\)</span>ï¼Œ<spanclass="math inline">\(V(x)\)</span>æ˜¯æœ‰ç•Œçš„</p><p><span class="math inline">\(2)\ V(x)&gt;0\)</span>ï¼Œå¯¹äºæ‰€æœ‰çš„<spanclass="math inline">\(s\in{R^n}\backslash \{x_e\}\)</span>ï¼Œ<spanclass="math inline">\(V(e_e)=0\)</span></p><p><span class="math inline">\(3)\inf_{u\in{U}}\dot{V}(x,u)&lt;0\)</span>ï¼Œå¯¹äºæ‰€æœ‰çš„<spanclass="math inline">\(x\in{\Omega_c}\backslash\{x_e\}\)</span></p><p>ä¸ºäº†ç®€åŒ–<spanclass="math inline">\(\dot{V}(x,u)\)</span>çš„è¡¨è¾¾ï¼Œç”¨Lieæ‹¬å·æè¿°ï¼š</p><p><span class="math display">\[\dot{V}(x,u) = \nabla{V}(x) * \dot{x} =\nabla{V}(x) * f(x) + \nabla{V}(x) * g(x)*u = L_fV(x) +L_gV(x)u\]</span> <spanclass="math display">\[(L_pq(x):=\nabla{q(x)}*p(x))\]</span></p><p>CLFä¿è¯ç³»ç»Ÿæœ€ç»ˆä¼šç¨³å®šï¼Œä½†ä¸èƒ½ç¡®å®šå¤šå¿«æ‰èƒ½ç¨³å®šï¼Œè¿™æ—¶å€™å¼•å…¥æŒ‡æ•°ç¨³å®šCLF(ESCLF)ã€‚</p><p>å¦‚æœå­˜åœ¨å¸¸æ•°<span class="math inline">\(\lambda &gt;0\)</span>ä½¿å¾—<span class="math inline">\(inf_{u\in{U}}\dot{V}(x,u)+{\lambda}{V(x)}\le0\)</span> ï¼Œé‚£ä¹ˆ<spanclass="math inline">\(V(x)\)</span>å°±æ˜¯ESCLFã€‚</p><p><img src="/img/CLF-CBF/ESCLF.png" /></p><h2 id="clf-qp">3.CLF-QP</h2><p>å°†CLFè½¬åŒ–ä¸ºQPé—®é¢˜ï¼Œæœç´¢æ»¡è¶³CLF-QPé—®é¢˜çš„è¾“å…¥uã€‚</p><p><span class="math display">\[argmin\  (u-u_ref)^{T}{H(u-u_ref)}+p\delta^2\]</span> <spanclass="math display">\[subject\ to :\L_fV(x)+L_gV(x)u+\lambda{V(x)}\le{\delta}\]</span></p><p>å…¶ä¸­<span class="math inline">\(\delta\)</span>æ˜¯æ¾å¼›å˜é‡ï¼Œ<spanclass="math inline">\(p\)</span>æ˜¯æƒ©ç½šå› å­ï¼Œè®¾ç½®æ¾å¼›å˜é‡çš„ç›®çš„æ˜¯åœ¨å®é™…æœç´¢ä¸­ï¼Œè¾ƒéš¾æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„è§£ï¼Œå¢åŠ æ¾å¼›å˜é‡åä¼šæ”¾æ¾CLFæ¡ä»¶ï¼Œåœ¨å…è®¸çš„æƒ…å†µä¸‹ä¸æ»¡è¶³CLFçº¦æŸï¼Œä½†è·å¾—ä¸€ä¸ªè§£ã€‚</p><p>å¦å¤–ï¼Œè¿™é‡Œçš„Hæ˜¯HassiançŸ©é˜µï¼Œè¡¨ç¤ºäºŒæ¬¡é¡¹ç³»æ•°ï¼Œå°†<spanclass="math inline">\((u-u_ref)^{T}{H(u-u_ref)}\)</span>ç†è§£ä¸ºäºŒæ¬¡çš„costå‡½æ•°(æˆ–è€…èƒ½é‡å‡½æ•°ï¼Ÿ)ï¼Œæ˜¯äººä¸ºæ„å»ºçš„ï¼ŒäºŒæ¬¡ä¿è¯è§£çš„uçš„è¾“å…¥ä½¿ç³»ç»Ÿæ”¶æ•›è¾ƒå¿«ã€‚</p><h2 id="cbf">4.CBF</h2><p>CLFçº¦æŸç¡®ä¿ç³»ç»Ÿæ¸è¶‹ç¨³å®šï¼Œè€ŒCBFçš„ä½œç”¨æ˜¯ç¡®ä¿ç³»ç»Ÿå®‰å…¨ï¼Œä½¿ç³»ç»Ÿå¤„äºè§„å®šçš„å®‰å…¨é›†åˆçº¦æŸå†…ã€‚</p><pre><code class="hljs">//TODO:è¡¥å……CBFåŸç†</code></pre><p>å½“<span class="math inline">\(B(x):\mathbb{R}^n \rightarrow\mathbb{R}\)</span>æ˜¯è¿ç»­å¯å¾®çš„ï¼Œé›¶è¶…æ°´å¹³é›†(zero-superlevel)ä¸º<spanclass="math inline">\(C\)</span>ï¼Œ<spanclass="math inline">\(C=\{x|B(x)\ge0\}\)</span>ï¼Œå¯¹äºæ‰€æœ‰<spanclass="math inline">\(x\in{\partial{C}}\)</span>ï¼Œ<spanclass="math inline">\(\nabla{B(x)\ne0}\)</span>ï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªæ‰©å±•<spanclass="math inline">\(Class \ K_\infty\)</span>å‡½æ•°<spanclass="math inline">\(\alpha\)</span>ï¼ˆå·¥ç¨‹ä¸­ä¸€èˆ¬ä½¿ç”¨æ­£å¸¸æ•°å’Œ<spanclass="math inline">\(B(x)\)</span>çš„çº¿æ€§ç»„åˆè·å–ï¼Œå¦‚ï¼š<spanclass="math inline">\(\gamma{B(x)},\gamma&gt;0\)</span>ï¼‰ï¼Œå­˜åœ¨ä¸€ä¸ªé›†åˆ<spanclass="math inline">\(D\subset{\mathbb{R}^n}\)</span>ï¼Œä½¿å¾—<spanclass="math inline">\(C\subset{D}\)</span>æ»¡è¶³ï¼š</p><p><spanclass="math display">\[sup_{u\in{U}}[L_f{B(x)}+L_g{B(x)}u]+\alpha({B(x)})\ge0\]</span></p><p>é‚£ä¹ˆå¯¹äºæ‰€æœ‰<span class="math inline">\(x\in{D}\)</span>ï¼Œ<spanclass="math inline">\(B(x)\)</span>æ˜¯ä¸€ä¸ªCBFã€‚</p><p><img src="/img/CLF-CBF/CBF.png" /></p><h2 id="clf-cbf-qp">5.CLF-CBF-QP</h2><p>å°†CLFå’ŒCBFéƒ½è½¬åŒ–ä¸ºQPé—®é¢˜çš„çº¦æŸæ¡ä»¶ï¼Œå…¶ä¸­CLFä¿è¯æ§åˆ¶å™¨ç¨³å®šï¼ŒCBFä¿è¯æ§åˆ¶æ»¡è¶³å®‰å…¨æ¡ä»¶ã€‚</p><p><span class="math display">\[argmin\  (u-u_ref)^{T}{H(u-u_ref)}+p\delta^2\]</span> <spanclass="math display">\[subject\ to :\]</span> <spanclass="math display">\[\L_fV(x)+L_gV(x)u+\lambda{V(x)}\le{\delta}\]</span> <spanclass="math display">\[L_f{B(x)}+L_g{B(x)}u]+\gamma{B(x)}\ge0\]</span></p><h2 id="links">links</h2><ul><li><em><ahref="https://zhuanlan.zhihu.com/p/568328445">æ ¹æ®è‡ªé€‚åº”å·¡èˆªç³»ç»Ÿ(ACC)æ¥ç†è§£CBF(ControlBarrier Function)-å…¥é—¨çŸ¥è¯†</a></em><br /></li><li><em><a href="https://zhuanlan.zhihu.com/p/277326421">CLF-CBFController</a></em><br /></li><li><em><ahref="https://github.com/HybridRobotics/CBF-CLF-Helper">HybridRobotics/CBF-CLF-Helper</a></em><br /></li><li><em><a href="https://www.youtube.com/watch?v=_Tkn_Hzo4AA">Jason Choi-- Introduction to Control Lyapunov Functions and Control BarrierFunctions</a></em></li></ul>]]></content>
    
    
    <categories>
      
      <category>æ§åˆ¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç†è®º</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åæ­¥æ§åˆ¶</title>
    <link href="/2024/09/04/%E5%8F%8D%E6%AD%A5%E6%8E%A7%E5%88%B6/"/>
    <url>/2024/09/04/%E5%8F%8D%E6%AD%A5%E6%8E%A7%E5%88%B6/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><h2 id="ç‰©ç†æ¨¡å‹">1.1 ç‰©ç†æ¨¡å‹</h2><p>ä»¤æœŸæœ›è½¨è¿¹ä¸º<span class="math inline">\(sint\)</span>æ›²çº¿ï¼š<br /><span class="math display">\[x_d = \sin{t}\]</span> <spanclass="math display">\[\dot{x_d} = \cos{t}\]</span></p><p>å†™å‡ºçŠ¶æ€æ–¹ç¨‹ï¼š<br /><span class="math display">\[\dot{x_1} = x_2 + f_1(x_1)\]</span> <spanclass="math display">\[\dot{x_2} = u + f_2(x_1,x_2) = u + \frac{(M * g *l)}{J} * \sin{x_1} - \frac{D}{J} * x_2\]</span></p><p><span class="math display">\[f_1(x_1) = 0\]</span> <spanclass="math display">\[f_2(x_1,x_2) = \frac{(M * g * l)}{J} * \sin{x_1}- \frac{D}{J} * x_2\]</span>å…¶ä¸­ç¬¬ä¸€é¡¹ä¸ºé‡åŠ›å¯¹ç³»ç»Ÿçš„å½±å“ï¼Œç¬¬äºŒé¡¹ä¸ºæ‘©æ“¦åŠ›å¯¹ç³»ç»Ÿçš„å½±å“ã€‚</p><p><em>å…¶ä¸­Mä¸ºè´¨é‡ï¼Œgä¸ºé‡åŠ›åŠ é€Ÿåº¦ï¼Œlä¸ºè‡‚é•¿ï¼ŒJä¸ºè½¬åŠ¨æƒ¯é‡ï¼ŒDä¸ºé˜»å°¼ç³»æ•°ã€‚</em><em><span class="math inline">\(\dot{x_1}\)</span>ä¸ºè§’é€Ÿåº¦ï¼Œ<spanclass="math inline">\(\dot{x_2}\)</span>ä¸ºè§’åŠ é€Ÿåº¦ï¼Œ<spanclass="math inline">\(x_1\)</span>ä¸ºè§’åº¦ï¼Œ<spanclass="math inline">\(x_2\)</span>ä¸ºè§’é€Ÿåº¦ã€‚</em></p><h2 id="çŸ¥è¯†è¡¥å……">1.2 çŸ¥è¯†è¡¥å……</h2><p>åŠ›çŸ©<span class="math inline">\(M = |F| * |r| *\sin{\varphi}\)</span>åŠ›çŸ©é™¤ä»¥è½¬åŠ¨æƒ¯é‡å¯ä»¥æè¿°ä¸€ä¸ªç‰©ä½“æ”¶åˆ°çš„å¤–éƒ¨åŠ›çŸ©å¯¹å…¶è§’åŠ é€Ÿåº¦çš„å½±å“ã€‚é˜»å°¼ç³»æ•°é™¤ä»¥è½¬åŠ¨æƒ¯é‡ä¹˜ä»¥è§’é€Ÿåº¦æè¿°äº†åœ¨è½¬åŠ¨è¿åŠ¨ä¸­ç”±é˜»å°¼äº§ç”Ÿçš„è½¬åŠ¨æ‘©æ“¦åŠ›çš„æ•ˆåº”ã€‚è¿™ä¸ªç‰©ç†é‡é€šå¸¸è¢«ç§°ä¸ºé˜»å°¼æ¯”ã€‚</p><p><em>*éƒ¨åˆ†è§£é‡Šæ¥è‡ªchatgpt</em></p><h2 id="åæ­¥æ§åˆ¶">2.1 åæ­¥æ§åˆ¶</h2><p>æ„é€ è¯¯å·® <span class="math display">\[e_1 = x_1 - x_d\]</span> <spanclass="math display">\[e_2 = x_2 - \alpha_1\]</span> å…¶ä¸­<spanclass="math inline">\(\alpha_1\)</span>ä¸ºè™šæ‹Ÿæ§åˆ¶å¾‹ï¼Œå³ä¸­é—´çŠ¶æ€çš„æ§åˆ¶é‡ã€‚</p><p>æ„é€ Lyapunovå‡½æ•° <span class="math display">\[V_1 =\frac{1}{2}{e_1}^2\]</span> <span class="math display">\[V_2 =\frac{1}{2}{e_1}^2 + \frac{1}{2}{e_2}^2\]</span></p><p>ç”±Lyapunovæ–¹æ³•å¯çŸ¥ï¼Œéœ€ä»¤<spanclass="math inline">\(\dot{V_1}\)</span> ,<spanclass="math inline">\(\dot{V_2}\)</span>è´Ÿå®šä½¿å¾—ç³»ç»Ÿæ¸è¶‹ç¨³å®šã€‚</p><p><span class="math display">\[\dot{V_1} = {e_1}\dot{e_1} ={e_1}(\dot{x_1} - \dot{x_d}) = {e_1}(x_2 + f_1(x_1) -\cos{t})\]</span></p><p>æ•…ä»¤<span class="math inline">\(\alpha_1 = \cos{t} - e_1 -f_1(x_1)\)</span>ï¼Œæ³¨æ„æ­¤æ—¶<spanclass="math inline">\(\alpha_1\)</span>ä¸ºè™šæ‹Ÿæ§åˆ¶å¾‹ï¼Œ<spanclass="math inline">\(x_2\)</span>ä¸ºå®é™…æ§åˆ¶</p><p><span class="math display">\[\dot{V_1} = {e_1}\dot{e_1} ={e_1}(\dot{x_1} - \dot{x_d})\]</span> <span class="math display">\[ ={e_1}(x_2 + f_1(x_1) - \cos{t}) = {e_1}(e_2 + \alpha_1 + f_1(x_1) -\cos{t}) = {e_1}(e_2 - e_1)\]</span></p><p><span class="math display">\[\dot{e_2} = \dot{x_2} - \dot{\alpha_1} =u + f_2(x_1,x_2) - \dot{\alpha_1}\]</span></p><p><span class="math display">\[\dot{V_2} = e_1(e_2 - e_1) +{e_2}\dot{e_2} = -{e_1}^2 + {e_2}({e_1} + \dot{e_2})\]</span></p><p>éœ€ä»¤<span class="math inline">\(\dot{V_2}\)</span>è´Ÿå®šï¼Œä»¤<spanclass="math inline">\(e_1 + \dot{e_2} = -e_2\)</span>å³å¯ï¼Œæ­¤æ—¶<spanclass="math inline">\(\dot{V_2} = -{e_1}^2 - {e_2}^2\)</span>è´Ÿå®š ä»£å…¥å¾—<span class="math inline">\(e_1 + u + f_2(x_1,x_2) - \alpha_1 =-e_2\)</span> å¾—åˆ°æœ€ç»ˆæ§åˆ¶é‡<span class="math inline">\(u = -e_1 - e_2 -f_2(x_1,x_2) + \dot{\alpha_1}\)</span></p><p>ä¸Šé¢å¾—åˆ° <span class="math display">\[f_1(x_1) = 0\]</span> <spanclass="math display">\[f_2(x_1,x_2) = \frac{(M * g * l)}{J} * \sin{x_1}- \frac{D}{J} * x_2\]</span></p><p>æ‰€ä»¥<span class="math display">\[u = -e_1 - e_2 + \dot{\alpha_1} -(\frac{(M * g * l)}{J} * \sin{x_1} - \frac{D}{J} * x_2)\]</span></p><h2 id="links">links</h2><ul><li><em><ahref="https://haosutopia.github.io/2018/01/Backstepping-01/">Backsteppingï¼ˆåæ­¥æ§åˆ¶ï¼‰</a></em></li><li><em><ahref="https://zh.wikipedia.org/wiki/%E5%8F%8D%E6%8E%A8%E6%8E%A7%E5%88%B6">wikiåæ¨æ§åˆ¶</a></em></li></ul>]]></content>
    
    
    <categories>
      
      <category>æ§åˆ¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç†è®º</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è£‚ç—•</title>
    <link href="/2024/09/03/%E8%A3%82%E7%97%95/"/>
    <url>/2024/09/03/%E8%A3%82%E7%97%95/</url>
    
    <content type="html"><![CDATA[<span id="more"></span><center>è£‚ç—•</center><center>è¾¹ç¼˜çº¹è·¯ç”Ÿé•¿ï¼Œ</center><center>å“­æ³£çš„ç¬‘å®¹ï¼Œ</center><center>è¿‡å»çš„å®Œæ•´å†æ— æœ‰å‡ åˆ†å­˜åœ¨ã€‚</center><center>çˆ±æˆ–æœªæ¥ï¼Œ</center><center>è‡ªç”˜åœ°é—å¿˜ã€‚</center><center>ç‡ƒçƒ§ä¸€ç›å¸çµé­‚ä¹Ÿæ— æ³•å¼¥è¡¥è¿™æ€¥è½¬éš”æ–­ï¼Œ</center><center>éƒ½ä¸è¶³ä¸€åƒå…¬é‡Œçš„æ—¶é—´é•¿ã€‚</center><center>ç¬¨æ‹™çš„èŠ±å¼ å£ç»“èˆŒï¼Œ</center><center>çœ¼æ³ªæµæ·Œã€‚</center><center>å‡ ç¼•è–„å½±å€å¿½è€Œè¿‡ï¼Œ</center><center>å“€è£å››æ³»ã€‚</center><center>ç ´ç¢ï¼Œ</center><center>æœˆå’Œç›®å…‰ã€‚</center><center>æºå¤´æ˜¯å»‰ä»·çš„æƒ…æ„Ÿç†æƒ³ï¼Œ</center><center>å°¾æµå…¥åœ°æµ·ã€‚</center><center>äºŒåˆ°ä¸€åˆ°äºŒï¼Œ</center><center>æ— åˆ°æœ‰åˆ°æ— ã€‚</center><center>è¿‡åº¦æˆ–ç¿¼ç¿¼æ»‹ç”Ÿè£‚éš™ï¼Œ</center><center>è‡ªäº§æ€’ç«æƒŠé›·ï¼Œ</center><center>é™é™æ’•å’¬ã€‚</center><center>æ›¾æ˜¯æ°¸è¿œå®Œæ•´æ°¸è¿œä¸€èµ·ï¼Œ</center><center>æ— æœ‰è¾“èµ¢ï¼Œ</center><center>è€Œä»Šå´æ˜¯è°¢å¹•æ—¶å…‰ã€‚</center><center>ç—›è‹¦æ€¥é€Ÿè½¬æ¢ï¼Œ</center><center>ä¸€é“æ— å½¢çš„è£‚ç—•æ‚„ç„¶è€Œç”Ÿï¼Œ</center><center>è‡ªæ­¤ç–¾é©°ã€‚</center><center>å¹»æƒ³å’Œç§‹é£ï¼Œ</center><center>ç”±æˆ‘äº²æ‰‹æ–©æ–­ï¼Œ</center><center>æ˜¾ç°çš„è£‚ç—•ï¼Œ</center><center>å­˜äºä½ æˆ‘å„è‡ªä¸–ç•Œä¹‹é—´</center>]]></content>
    
    
    <categories>
      
      <category>å‘ç”µ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>poem</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
