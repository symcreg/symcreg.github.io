

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=dark>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/my_icon.png">
  <link rel="icon" href="/img/my_icon.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="sam">
  <meta name="keywords" content="">
  
    <meta name="description" content="Sincerely recommend read this article on my Blog, the Blog will have a better reading experience. And the code is on my Github A. The experiment purpose two computer hosts as server and client c">
<meta property="og:type" content="article">
<meta property="og:title" content="experiment of socket">
<meta property="og:url" content="https://symcreg.github.io/2024/11/21/experiment-of-socket/index.html">
<meta property="og:site_name" content="symc">
<meta property="og:description" content="Sincerely recommend read this article on my Blog, the Blog will have a better reading experience. And the code is on my Github A. The experiment purpose two computer hosts as server and client c">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://symcreg.github.io/img/experiment-of-socket/process.png">
<meta property="og:image" content="https://symcreg.github.io/img/experiment-of-socket/ipconfig.png">
<meta property="og:image" content="https://symcreg.github.io/img/experiment-of-socket/ifconfig.png">
<meta property="og:image" content="https://symcreg.github.io/img/experiment-of-socket/ping.png">
<meta property="og:image" content="https://symcreg.github.io/img/experiment-of-socket/server.png">
<meta property="og:image" content="https://symcreg.github.io/img/experiment-of-socket/client.png">
<meta property="og:image" content="https://symcreg.github.io/img/experiment-of-socket/server-udp.png">
<meta property="og:image" content="https://symcreg.github.io/img/experiment-of-socket/client-udp.png">
<meta property="article:published_time" content="2024-11-21T09:31:56.000Z">
<meta property="article:modified_time" content="2024-11-21T10:49:35.578Z">
<meta property="article:author" content="sam">
<meta property="article:tag" content="socket">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://symcreg.github.io/img/experiment-of-socket/process.png">
  
  
  
  <title>experiment of socket - symc</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"symcreg.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":50,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":"G-0MP4SFZQ6C"},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=G-0MP4SFZQ6C", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', 'G-0MP4SFZQ6C');
        });
      }
    </script>
  

  

  

  



  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>symc</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/my_banner.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="experiment of socket"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-11-21 17:31" pubdate>
          2024年11月21日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          1.7k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          15 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">experiment of socket</h1>
            
            
              <div class="markdown-body">
                
                <span id="more"></span>
<p>Sincerely recommend read this article on my <a
href="https://symcreg.github.io/2024/11/21/experiment-of-socket/">Blog</a>,
the Blog will have a better reading experience.</p>
<p>And the code is on my <a
target="_blank" rel="noopener" href="https://github.com/symcreg/experiment_socket">Github</a></p>
<h3 id="a.-the-experiment-purpose">A. The experiment purpose</h3>
<p>two computer hosts as server and client communicate with each
other.<br />
With socket programmning respectively with TCP and UDP, realize the
following application:<br />
1. client reads a line of characters (data) from its keyboard and sends
data to server<br />
2. server receives the data<br />
3. server converts lowercase letters to uppercase letters , and sends
the data to client<br />
4. client receives the data and displays line on its screen</p>
<figure>
<img src="/img/experiment-of-socket/process.png" srcset="/img/loading.gif" lazyload alt="process" />
<figcaption aria-hidden="true">process</figcaption>
</figure>
<h3 id="b.-materials">B. Materials</h3>
<p>Hardware: Lenovo Legion R7000<br />
Software: Windows11, Ubuntu18.04, Clion, Pycharm,VMware Workstation,
c++, python<br />
Network Configuration: Bridge Mode between virtual machine and physical
machine</p>
<h3 id="c.-procedure">C. Procedure</h3>
<h4
id="first-we-need-to-figure-out-the-ip-address-of-the-server-and-client.">0.
First, we need to figure out the IP address of the server and
client.</h4>
<p>In windows, we can use 'ipconfig' to get the IP address of the server
and client while in linux, we can use ifconfig to get the IP address of
the server and client.(In this experiment, the server is the physical
machine and the client is the virtual machine, and the network mode is
bridge mode)</p>
<p><img src="/img/experiment-of-socket/ipconfig.png" srcset="/img/loading.gif" lazyload
alt="ipconfig" /><br />
<img src="/img/experiment-of-socket/ifconfig.png" srcset="/img/loading.gif" lazyload alt="ifconfig" /></p>
<p>in this experiment, the IP address of the server is:
10.136.12.124</p>
<p>and the IP address of the client is: 192.168.58.130</p>
<p>we choose 8080 as the port of the server.</p>
<p>use ping to check the connection between the server and the
client.</p>
<figure>
<img src="/img/experiment-of-socket/ping.png" srcset="/img/loading.gif" lazyload alt="ping" />
<figcaption aria-hidden="true">ping</figcaption>
</figure>
<p>if the ping is successful, we can start the socket programming.</p>
<h4 id="server-side">1. Server side</h4>
<h5 id="create-a-socket-with-the-socket-system-call.">1.1. Create a
socket with the socket() system call.</h5>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c++">WORD version = <span class="hljs-built_in">MAKEWORD</span>(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>);<br>WSADATA data;<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">WSAStartup</span>(version, &amp;data) != <span class="hljs-number">0</span>) &#123;<br>    std::cerr &lt;&lt; <span class="hljs-string">&quot;Failed to start WSA&quot;</span> &lt;&lt; std::endl;<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><span class="hljs-keyword">this</span>-&gt;port_ = port;<br><span class="hljs-comment">//protocol: 0 means TCP, 1 means UDP</span><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>-&gt;protocol_ == <span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-keyword">this</span>-&gt;server_fd_ = <span class="hljs-built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>-&gt;protocol_ == <span class="hljs-number">1</span>)&#123;<br>    <span class="hljs-keyword">this</span>-&gt;server_fd_ = <span class="hljs-built_in">socket</span>(AF_INET, SOCK_DGRAM, <span class="hljs-number">0</span>);<br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>-&gt;server_fd_ == <span class="hljs-number">-1</span>) &#123;<br>    std::cerr &lt;&lt; <span class="hljs-string">&quot;Failed to create socket&quot;</span> &lt;&lt; std::endl;<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-keyword">this</span>-&gt;server_addr_.sin_family = AF_INET; <span class="hljs-comment">//sin means socket internet</span><br><span class="hljs-keyword">this</span>-&gt;server_addr_.sin_addr.s_addr = INADDR_ANY;<br><span class="hljs-keyword">this</span>-&gt;server_addr_.sin_port = <span class="hljs-built_in">htons</span>(<span class="hljs-keyword">this</span>-&gt;port_);<br><br></code></pre></td></tr></table></figure>
<p>we set the verstion of the socket to 2.2, and start the WSA, then
create a socket with the socket() system call. We can choose the
protocol of the socket, 0 means TCP, 1 means UDP.</p>
<p>parameters of the socket() system call:<br />
- domain: AF_INET(ipv4), AF_INET6, AF_UNIX, AF_UNSPEC<br />
- type: SOCK_STREAM(tcp), SOCK_DGRAM(udp), SOCK_RAW,
SOCK_SEQPACKET<br />
- protocol: 0 means auto choose the protocol</p>
<p>Then we set the server address, the family is AF_INET, the address is
INADDR_ANY, and the port is the port we choose(8080).</p>
<p>fd means file descriptor, which is an integer that is used to access
the socket.</p>
<h5
id="bind-the-socket-to-an-address-using-the-bind-system-call.-for-a-server-socket-on-the-internet-an-address-consists-of-a-port-number-on-the-host-machine.">1.2.
Bind the socket to an address using the bind() system call. For a server
socket on the Internet, an address consists of a port number on the host
machine.</h5>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">this</span>-&gt;server_addr_.sin_family = AF_INET; <span class="hljs-comment">//sin means socket internet</span><br><span class="hljs-keyword">this</span>-&gt;server_addr_.sin_addr.s_addr = INADDR_ANY;<br><span class="hljs-keyword">this</span>-&gt;server_addr_.sin_port = <span class="hljs-built_in">htons</span>(<span class="hljs-keyword">this</span>-&gt;port_);<br><br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">bind</span>(<span class="hljs-keyword">this</span>-&gt;server_fd_, (<span class="hljs-keyword">struct</span> sockaddr *) &amp;<span class="hljs-keyword">this</span>-&gt;server_addr_, <span class="hljs-built_in">sizeof</span>(<span class="hljs-keyword">this</span>-&gt;server_addr_)) &lt; <span class="hljs-number">0</span>) &#123;<br>    std::cerr &lt;&lt; <span class="hljs-string">&quot;Failed to bind socket&quot;</span> &lt;&lt; std::endl;<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-keyword">this</span>-&gt;client_addr_len_ = <span class="hljs-built_in">sizeof</span>(<span class="hljs-keyword">this</span>-&gt;client_addr_);<br></code></pre></td></tr></table></figure>
<p>we set the server address again, then bind the socket to the address
we set before. If the bind() system call fails, we will exit the
program.</p>
<h5 id="listen-for-connections-with-the-listen-system-call.">1.3. Listen
for connections with the listen() system call.</h5>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>-&gt;protocol_ == <span class="hljs-number">0</span>) &#123;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;[TCP]&quot;</span> &lt;&lt; std::endl;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">listen</span>(<span class="hljs-keyword">this</span>-&gt;server_fd_, <span class="hljs-number">10</span>) &lt; <span class="hljs-number">0</span>) &#123;<br>        std::cerr &lt;&lt; <span class="hljs-string">&quot;Failed to listen&quot;</span> &lt;&lt; std::endl;<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>-&gt;protocol_ == <span class="hljs-number">1</span>)&#123;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;[UDP]&quot;</span> &lt;&lt; std::endl;<br>&#125;<br>std::cout &lt;&lt; <span class="hljs-string">&quot;Server started on port &quot;</span> &lt;&lt; <span class="hljs-keyword">this</span>-&gt;port_ &lt;&lt; std::endl;<br></code></pre></td></tr></table></figure>
<p>if the protocol is TCP, we will listen for connections with the
listen() system call, the second parameter is the maximum length of the
queue of pending connections, if the queue is full, the client will be
refused to connect.</p>
<p>if the protocol is UDP, we will just print "[UDP]" because UDP is
connectionless.</p>
<h5
id="accept-a-connection-with-the-accept-system-call.-this-call-typically-blocks-until-a-client-connects-with-the-server.">1.4.
Accept a connection with the accept() system call. This call typically
blocks until a client connects with the server.</h5>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>-&gt;protocol_ == <span class="hljs-number">1</span>)&#123;<br>    std::cerr &lt;&lt; <span class="hljs-string">&quot;UDP does not support accept&quot;</span> &lt;&lt; std::endl;<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><span class="hljs-keyword">this</span>-&gt;client_fd_ = ::<span class="hljs-built_in">accept</span>(<span class="hljs-keyword">this</span>-&gt;server_fd_, (<span class="hljs-keyword">struct</span> sockaddr *) &amp;<span class="hljs-keyword">this</span>-&gt;client_addr_, &amp;<span class="hljs-keyword">this</span>-&gt;client_addr_len_);<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>-&gt;client_fd_ &lt; <span class="hljs-number">0</span>) &#123;<br>    std::cerr &lt;&lt; <span class="hljs-string">&quot;Failed to accept client&quot;</span> &lt;&lt; std::endl;<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br>std::cout &lt;&lt; <span class="hljs-string">&quot;Client connected&quot;</span> &lt;&lt; std::endl;<br></code></pre></td></tr></table></figure>
<p>UDP does not support accept, so we will exit the program if the
protocol is UDP.</p>
<p>if the protocol is TCP, we will accept a connection with the accept()
system call, the second parameter is the address of the client, the
third parameter is the length of the address of the client.</p>
<h5 id="send-and-receive-data.">1.5. Send and receive data.</h5>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>-&gt;protocol_ == <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-keyword">if</span> (::<span class="hljs-built_in">send</span>(<span class="hljs-keyword">this</span>-&gt;client_fd_, message, <span class="hljs-built_in">strlen</span>(message), <span class="hljs-number">0</span>) &lt; <span class="hljs-number">0</span>) &#123;<br>        std::cerr &lt;&lt; <span class="hljs-string">&quot;Failed to send message&quot;</span> &lt;&lt; std::endl;<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>-&gt;protocol_ == <span class="hljs-number">1</span>)&#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">sendto</span>(<span class="hljs-keyword">this</span>-&gt;server_fd_, message, <span class="hljs-built_in">strlen</span>(message), <span class="hljs-number">0</span>, (<span class="hljs-keyword">struct</span> sockaddr *) &amp;<span class="hljs-keyword">this</span>-&gt;client_addr_, <span class="hljs-built_in">sizeof</span>(<span class="hljs-keyword">this</span>-&gt;client_addr_)) &lt; <span class="hljs-number">0</span>) &#123;<br>        std::cerr &lt;&lt; <span class="hljs-string">&quot;Failed to send message&quot;</span> &lt;&lt; std::endl;<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>if the protocol is TCP, we will use send() to send the message to the
client.</p>
<p>if the protocol is UDP, we will use sendto() to send the message to
the client.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-built_in">memset</span>(<span class="hljs-keyword">this</span>-&gt;buffer_, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(<span class="hljs-keyword">this</span>-&gt;buffer_));<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>-&gt;protocol_ == <span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">recv</span>(<span class="hljs-keyword">this</span>-&gt;client_fd_, <span class="hljs-keyword">this</span>-&gt;buffer_, <span class="hljs-built_in">sizeof</span>(<span class="hljs-keyword">this</span>-&gt;buffer_), <span class="hljs-number">0</span>) &lt; <span class="hljs-number">0</span>) &#123;<br>        std::cerr &lt;&lt; <span class="hljs-string">&quot;Failed to receive message&quot;</span> &lt;&lt; std::endl;<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>-&gt;protocol_ == <span class="hljs-number">1</span>)&#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">recvfrom</span>(<span class="hljs-keyword">this</span>-&gt;server_fd_, <span class="hljs-keyword">this</span>-&gt;buffer_, <span class="hljs-built_in">sizeof</span>(<span class="hljs-keyword">this</span>-&gt;buffer_), <span class="hljs-number">0</span>, (<span class="hljs-keyword">struct</span> sockaddr *) &amp;<span class="hljs-keyword">this</span>-&gt;client_addr_, &amp;<span class="hljs-keyword">this</span>-&gt;client_addr_len_) &lt; <span class="hljs-number">0</span>) &#123;<br>        std::cerr &lt;&lt; <span class="hljs-string">&quot;Failed to receive message&quot;</span> &lt;&lt; std::endl;<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">this</span>-&gt;buffer_size_ = <span class="hljs-built_in">strlen</span>(<span class="hljs-keyword">this</span>-&gt;buffer_);<br><span class="hljs-keyword">return</span> buffer_size_;<br></code></pre></td></tr></table></figure>
<p>if the protocol is TCP, we will use recv() to receive the message
from the client.</p>
<p>if the protocol is UDP, we will use recvfrom() to receive the message
from the client.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">char</span>* <span class="hljs-title">Server::GetBuffer</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>-&gt;buffer_;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>we will return the buffer pointer to the client for string
processing.</p>
<h5 id="close-the-connection.">1.6. Close the connection.</h5>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Server::Close</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-built_in">closesocket</span>(<span class="hljs-keyword">this</span>-&gt;client_fd_);<br>    <span class="hljs-built_in">closesocket</span>(<span class="hljs-keyword">this</span>-&gt;server_fd_);<br>    <span class="hljs-built_in">WSACleanup</span>();<br>&#125;<br></code></pre></td></tr></table></figure>
<p>Just close the client_fd and server_fd, and cleanup the WSA.</p>
<h4 id="main-function">~ main function</h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;winsock2.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;server.h&quot;</span></span><br><br><span class="hljs-type">int</span> protocol = <span class="hljs-number">1</span>;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Lowercase2Uppercase</span><span class="hljs-params">(<span class="hljs-type">char</span> *str)</span> </span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; str[i] != <span class="hljs-string">&#x27;\0&#x27;</span>; i++) &#123;<br>        <span class="hljs-keyword">if</span> (str[i] &gt;= <span class="hljs-string">&#x27;a&#x27;</span> &amp;&amp; str[i] &lt;= <span class="hljs-string">&#x27;z&#x27;</span>) &#123;<br>            str[i] -= <span class="hljs-number">32</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-function">Server <span class="hljs-title">server</span><span class="hljs-params">(<span class="hljs-number">8080</span>, protocol)</span></span>;<br>    server.<span class="hljs-built_in">Start</span>();<br>    <span class="hljs-type">int</span> msg_size = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)&#123;<br>        <span class="hljs-keyword">if</span>(protocol == <span class="hljs-number">0</span>)&#123;<br>            server.<span class="hljs-built_in">Accept</span>();<br>        &#125;<br>        msg_size = server.<span class="hljs-built_in">Receive</span>();<br>        <span class="hljs-keyword">if</span>(msg_size)&#123;<br>            <span class="hljs-keyword">if</span>(server.<span class="hljs-built_in">GetBuffer</span>()[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;q&#x27;</span> &amp;&amp; server.<span class="hljs-built_in">GetBuffer</span>()[<span class="hljs-number">1</span>] == <span class="hljs-string">&#x27;\0&#x27;</span>)&#123;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>            std::cout &lt;&lt; <span class="hljs-string">&quot;Client: &quot;</span> &lt;&lt; server.<span class="hljs-built_in">GetBuffer</span>() &lt;&lt; std::endl;<br>            <span class="hljs-built_in">Lowercase2Uppercase</span>(server.<span class="hljs-built_in">GetBuffer</span>());<br>            server.<span class="hljs-built_in">Send</span>(server.<span class="hljs-built_in">GetBuffer</span>());<br>            std::cout &lt;&lt; <span class="hljs-string">&quot;Server: &quot;</span> &lt;&lt; server.<span class="hljs-built_in">GetBuffer</span>() &lt;&lt; std::endl;<br>        &#125;<br>    &#125;<br>    server.<span class="hljs-built_in">Close</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>we create a server object with the port and protocol we choose, then
start the server.</p>
<p>then we use a while loop to receive the message from the client, if
the message is 'q', we will break the loop.</p>
<p>if the message is not 'q', we will print the message from the client,
convert the lowercase letters to uppercase letters, send the message to
the client, and print the message from the server.</p>
<p>finally, we close the server.</p>
<h4 id="client-side">2.Client side</h4>
<p>We have just finished the server side with c++, now we will start the
client side with python.</p>
<h5 id="create-a-socket-with-the-socket-system-call.-1">2.1. Create a
socket with the socket() system call.</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># protocol = socket.SOCK_STREAM # TCP</span><br>protocol = socket.SOCK_DGRAM <span class="hljs-comment"># UDP</span><br>server = <span class="hljs-string">&#x27;127.0.0.1&#x27;</span><br>port = <span class="hljs-number">8080</span><br><br>s = socket.socket(socket.AF_INET, protocol)<br><span class="hljs-keyword">if</span> protocol == socket.SOCK_STREAM:<br>    s.connect((server, port))<br></code></pre></td></tr></table></figure>
<p>we can choose the protocol of the socket, socket.SOCK_STREAM means
TCP, socket.SOCK_DGRAM means UDP.</p>
<p>Then we create a socket with the socket() system call, the first
parameter is the family of the socket, the second parameter is the
protocol of the socket.</p>
<p>if the protocol is TCP, we will connect to the server with the
connect() system call.</p>
<h5 id="send-and-receive-data.-1">2.2. Send and receive data.</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>message = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;Enter your message: &#x27;</span>)<br><span class="hljs-keyword">if</span> protocol == socket.SOCK_DGRAM:<br>    s.sendto(message.encode(), (server, port))<br>    <span class="hljs-keyword">if</span> message == <span class="hljs-string">&#x27;q&#x27;</span>:<br>        <span class="hljs-keyword">break</span><br>    response, addr = s.recvfrom(<span class="hljs-number">1024</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;server: &#x27;</span>+response.decode())<br>    <span class="hljs-keyword">continue</span><br>s.send(message.encode())<br><span class="hljs-keyword">if</span> message == <span class="hljs-string">&#x27;q&#x27;</span>:<br>    <span class="hljs-keyword">break</span><br>response = s.recv(<span class="hljs-number">1024</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;server: &#x27;</span>+response.decode())<br></code></pre></td></tr></table></figure>
<p>if the protocol is UDP, we will use sendto() to send the message to
the server, and use recvfrom() to receive the message from the
server.</p>
<p>if the protocol is TCP, we will use send() to send the message to the
server, and use recv() to receive the message from the server.</p>
<h5 id="close-the-connection.-1">2.3. Close the connection.</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">s.close()<br></code></pre></td></tr></table></figure>
<p>Just close the socket.</p>
<h3 id="d.-results-and-analysis">D. Results and Analysis</h3>
<h4 id="tcp">1. TCP</h4>
<h5 id="server-side-1">1.1. Server side</h5>
<figure>
<img src="/img/experiment-of-socket/server.png" srcset="/img/loading.gif" lazyload alt="server" />
<figcaption aria-hidden="true">server</figcaption>
</figure>
<h5 id="client-side-1">1.2. Client side</h5>
<figure>
<img src="/img/experiment-of-socket/client.png" srcset="/img/loading.gif" lazyload alt="client" />
<figcaption aria-hidden="true">client</figcaption>
</figure>
<h4 id="udp">2. UDP</h4>
<h5 id="server-side-2">2.1. Server side</h5>
<figure>
<img src="/img/experiment-of-socket/server-udp.png" srcset="/img/loading.gif" lazyload alt="server-udp" />
<figcaption aria-hidden="true">server-udp</figcaption>
</figure>
<h5 id="client-side-2">2.2. Client side</h5>
<figure>
<img src="/img/experiment-of-socket/client-udp.png" srcset="/img/loading.gif" lazyload alt="client-udp" />
<figcaption aria-hidden="true">client-udp</figcaption>
</figure>
<h3 id="e.-conclusion">E. Conclusion</h3>
<p>In this experiment, we have realized the communication between the
server and the client with socket programming.</p>
<p>We have used TCP and UDP respectively, and the results show that the
communication is successful.</p>
<h3 id="f.-code">F. Code</h3>
<p>you can find the code <a
target="_blank" rel="noopener" href="https://github.com/symcreg/experiment_socket">here</a>.</p>
<p>or the code is as follows:</p>
<h4 id="server.h">server.h</h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//</span><br><span class="hljs-comment">// Created by symc on 2024/11/21.</span><br><span class="hljs-comment">//</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> NET_SOCKET_SERVER_H</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> NET_SOCKET_SERVER_H</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;winsock2.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> comment(lib, <span class="hljs-string">&quot;ws2_32.lib&quot;</span>)</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Server</span> &#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">int</span> protocol_;<br>    <span class="hljs-type">int</span> port_; <span class="hljs-comment">// server port_</span><br>    <span class="hljs-type">int</span> server_fd_; <span class="hljs-comment">// server file descriptor</span><br>    <span class="hljs-type">int</span> client_fd_; <span class="hljs-comment">// client file descriptor</span><br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">sockaddr_in</span> server_addr_;<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">sockaddr_in</span> client_addr_;<br>    <span class="hljs-type">int</span> client_addr_len_;<br>    <span class="hljs-type">char</span> buffer_[<span class="hljs-number">1024</span>];<br>    <span class="hljs-type">int</span> buffer_size_ = <span class="hljs-number">1024</span>;<br><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Server</span>(<span class="hljs-type">int</span> port = <span class="hljs-number">8080</span>, <span class="hljs-type">int</span> protocal = <span class="hljs-number">0</span>);<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Start</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Accept</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Send</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *message)</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">Receive</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">char</span>* <span class="hljs-title">GetBuffer</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Close</span><span class="hljs-params">()</span></span>;<br>    ~<span class="hljs-built_in">Server</span>()&#123;<br>        <span class="hljs-built_in">Close</span>();<br>    &#125;<br>&#125;;<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">//NET_SOCKET_SERVER_H</span></span><br></code></pre></td></tr></table></figure>
<h4 id="server.cpp">server.cpp</h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//</span><br><span class="hljs-comment">// Created by symc on 2024/11/21.</span><br><span class="hljs-comment">//</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;server.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;winsock2.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> comment(lib, <span class="hljs-string">&quot;ws2_32.lib&quot;</span>)</span><br><br><br>Server::<span class="hljs-built_in">Server</span>(<span class="hljs-type">int</span> port, <span class="hljs-type">int</span> protocal) &#123;<br>    <span class="hljs-keyword">this</span>-&gt;protocol_ = protocal;<br>    WORD version = <span class="hljs-built_in">MAKEWORD</span>(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>);<br>    WSADATA data;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">WSAStartup</span>(version, &amp;data) != <span class="hljs-number">0</span>) &#123;<br>        std::cerr &lt;&lt; <span class="hljs-string">&quot;Failed to start WSA&quot;</span> &lt;&lt; std::endl;<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    <span class="hljs-keyword">this</span>-&gt;port_ = port;<br>    <span class="hljs-comment">//protocol: 0 means TCP, 1 means UDP</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>-&gt;protocol_ == <span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-keyword">this</span>-&gt;server_fd_ = <span class="hljs-built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>-&gt;protocol_ == <span class="hljs-number">1</span>)&#123;<br>        <span class="hljs-keyword">this</span>-&gt;server_fd_ = <span class="hljs-built_in">socket</span>(AF_INET, SOCK_DGRAM, <span class="hljs-number">0</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>-&gt;server_fd_ == <span class="hljs-number">-1</span>) &#123;<br>        std::cerr &lt;&lt; <span class="hljs-string">&quot;Failed to create socket&quot;</span> &lt;&lt; std::endl;<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">this</span>-&gt;server_addr_.sin_family = AF_INET; <span class="hljs-comment">//sin means socket internet</span><br>    <span class="hljs-keyword">this</span>-&gt;server_addr_.sin_addr.s_addr = INADDR_ANY;<br>    <span class="hljs-keyword">this</span>-&gt;server_addr_.sin_port = <span class="hljs-built_in">htons</span>(<span class="hljs-keyword">this</span>-&gt;port_);<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">bind</span>(<span class="hljs-keyword">this</span>-&gt;server_fd_, (<span class="hljs-keyword">struct</span> sockaddr *) &amp;<span class="hljs-keyword">this</span>-&gt;server_addr_, <span class="hljs-built_in">sizeof</span>(<span class="hljs-keyword">this</span>-&gt;server_addr_)) &lt; <span class="hljs-number">0</span>) &#123;<br>        std::cerr &lt;&lt; <span class="hljs-string">&quot;Failed to bind socket&quot;</span> &lt;&lt; std::endl;<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">this</span>-&gt;client_addr_len_ = <span class="hljs-built_in">sizeof</span>(<span class="hljs-keyword">this</span>-&gt;client_addr_);<br><br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Server::Start</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>-&gt;protocol_ == <span class="hljs-number">0</span>) &#123;<br>        std::cout &lt;&lt; <span class="hljs-string">&quot;[TCP]&quot;</span> &lt;&lt; std::endl;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">listen</span>(<span class="hljs-keyword">this</span>-&gt;server_fd_, <span class="hljs-number">10</span>) &lt; <span class="hljs-number">0</span>) &#123;<br>            std::cerr &lt;&lt; <span class="hljs-string">&quot;Failed to listen&quot;</span> &lt;&lt; std::endl;<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>-&gt;protocol_ == <span class="hljs-number">1</span>)&#123;<br>        std::cout &lt;&lt; <span class="hljs-string">&quot;[UDP]&quot;</span> &lt;&lt; std::endl;<br>    &#125;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Server started on port &quot;</span> &lt;&lt; <span class="hljs-keyword">this</span>-&gt;port_ &lt;&lt; std::endl;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Server::Accept</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>-&gt;protocol_ == <span class="hljs-number">1</span>)&#123;<br>        std::cerr &lt;&lt; <span class="hljs-string">&quot;UDP does not support accept&quot;</span> &lt;&lt; std::endl;<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    <span class="hljs-keyword">this</span>-&gt;client_fd_ = ::<span class="hljs-built_in">accept</span>(<span class="hljs-keyword">this</span>-&gt;server_fd_, (<span class="hljs-keyword">struct</span> sockaddr *) &amp;<span class="hljs-keyword">this</span>-&gt;client_addr_, &amp;<span class="hljs-keyword">this</span>-&gt;client_addr_len_);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>-&gt;client_fd_ &lt; <span class="hljs-number">0</span>) &#123;<br>        std::cerr &lt;&lt; <span class="hljs-string">&quot;Failed to accept client&quot;</span> &lt;&lt; std::endl;<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Client connected&quot;</span> &lt;&lt; std::endl;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Server::Send</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *message)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>-&gt;protocol_ == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">if</span> (::<span class="hljs-built_in">send</span>(<span class="hljs-keyword">this</span>-&gt;client_fd_, message, <span class="hljs-built_in">strlen</span>(message), <span class="hljs-number">0</span>) &lt; <span class="hljs-number">0</span>) &#123;<br>            std::cerr &lt;&lt; <span class="hljs-string">&quot;Failed to send message&quot;</span> &lt;&lt; std::endl;<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>-&gt;protocol_ == <span class="hljs-number">1</span>)&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">sendto</span>(<span class="hljs-keyword">this</span>-&gt;server_fd_, message, <span class="hljs-built_in">strlen</span>(message), <span class="hljs-number">0</span>, (<span class="hljs-keyword">struct</span> sockaddr *) &amp;<span class="hljs-keyword">this</span>-&gt;client_addr_, <span class="hljs-built_in">sizeof</span>(<span class="hljs-keyword">this</span>-&gt;client_addr_)) &lt; <span class="hljs-number">0</span>) &#123;<br>            std::cerr &lt;&lt; <span class="hljs-string">&quot;Failed to send message&quot;</span> &lt;&lt; std::endl;<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">Server::Receive</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-built_in">memset</span>(<span class="hljs-keyword">this</span>-&gt;buffer_, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(<span class="hljs-keyword">this</span>-&gt;buffer_));<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>-&gt;protocol_ == <span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">recv</span>(<span class="hljs-keyword">this</span>-&gt;client_fd_, <span class="hljs-keyword">this</span>-&gt;buffer_, <span class="hljs-built_in">sizeof</span>(<span class="hljs-keyword">this</span>-&gt;buffer_), <span class="hljs-number">0</span>) &lt; <span class="hljs-number">0</span>) &#123;<br>            std::cerr &lt;&lt; <span class="hljs-string">&quot;Failed to receive message&quot;</span> &lt;&lt; std::endl;<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>-&gt;protocol_ == <span class="hljs-number">1</span>)&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">recvfrom</span>(<span class="hljs-keyword">this</span>-&gt;server_fd_, <span class="hljs-keyword">this</span>-&gt;buffer_, <span class="hljs-built_in">sizeof</span>(<span class="hljs-keyword">this</span>-&gt;buffer_), <span class="hljs-number">0</span>, (<span class="hljs-keyword">struct</span> sockaddr *) &amp;<span class="hljs-keyword">this</span>-&gt;client_addr_, &amp;<span class="hljs-keyword">this</span>-&gt;client_addr_len_) &lt; <span class="hljs-number">0</span>) &#123;<br>            std::cerr &lt;&lt; <span class="hljs-string">&quot;Failed to receive message&quot;</span> &lt;&lt; std::endl;<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">this</span>-&gt;buffer_size_ = <span class="hljs-built_in">strlen</span>(<span class="hljs-keyword">this</span>-&gt;buffer_);<br>    <span class="hljs-keyword">return</span> buffer_size_;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">char</span>* <span class="hljs-title">Server::GetBuffer</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>-&gt;buffer_;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Server::Close</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-built_in">closesocket</span>(<span class="hljs-keyword">this</span>-&gt;client_fd_);<br>    <span class="hljs-built_in">closesocket</span>(<span class="hljs-keyword">this</span>-&gt;server_fd_);<br>    <span class="hljs-built_in">WSACleanup</span>();<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="main.cpp">main.cpp</h4>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;winsock2.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;server.h&quot;</span></span><br><br><span class="hljs-type">int</span> protocol = <span class="hljs-number">1</span>;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Lowercase2Uppercase</span><span class="hljs-params">(<span class="hljs-type">char</span> *str)</span> </span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; str[i] != <span class="hljs-string">&#x27;\0&#x27;</span>; i++) &#123;<br>        <span class="hljs-keyword">if</span> (str[i] &gt;= <span class="hljs-string">&#x27;a&#x27;</span> &amp;&amp; str[i] &lt;= <span class="hljs-string">&#x27;z&#x27;</span>) &#123;<br>            str[i] -= <span class="hljs-number">32</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-function">Server <span class="hljs-title">server</span><span class="hljs-params">(<span class="hljs-number">8080</span>, protocol)</span></span>;<br>    server.<span class="hljs-built_in">Start</span>();<br>    <span class="hljs-type">int</span> msg_size = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)&#123;<br>        <span class="hljs-keyword">if</span>(protocol == <span class="hljs-number">0</span>)&#123;<br>            server.<span class="hljs-built_in">Accept</span>();<br>        &#125;<br>        msg_size = server.<span class="hljs-built_in">Receive</span>();<br>        <span class="hljs-keyword">if</span>(msg_size)&#123;<br>            <span class="hljs-keyword">if</span>(server.<span class="hljs-built_in">GetBuffer</span>()[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;q&#x27;</span> &amp;&amp; server.<span class="hljs-built_in">GetBuffer</span>()[<span class="hljs-number">1</span>] == <span class="hljs-string">&#x27;\0&#x27;</span>)&#123;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>            std::cout &lt;&lt; <span class="hljs-string">&quot;Client: &quot;</span> &lt;&lt; server.<span class="hljs-built_in">GetBuffer</span>() &lt;&lt; std::endl;<br>            <span class="hljs-built_in">Lowercase2Uppercase</span>(server.<span class="hljs-built_in">GetBuffer</span>());<br>            server.<span class="hljs-built_in">Send</span>(server.<span class="hljs-built_in">GetBuffer</span>());<br>            std::cout &lt;&lt; <span class="hljs-string">&quot;Server: &quot;</span> &lt;&lt; server.<span class="hljs-built_in">GetBuffer</span>() &lt;&lt; std::endl;<br>        &#125;<br>    &#125;<br>    server.<span class="hljs-built_in">Close</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>we should also add the ws2_32.lib in the CMakeLists.txt file.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">target_link_libraries</span>(net_socket ws2_32)<br></code></pre></td></tr></table></figure>
<h4 id="client.py">client.py</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> socket<br><br><span class="hljs-comment"># protocol = socket.SOCK_STREAM # TCP</span><br>protocol = socket.SOCK_DGRAM <span class="hljs-comment"># UDP</span><br>server = <span class="hljs-string">&#x27;10.136.12.124&#x27;</span><span class="hljs-comment"># 10.136.12.124</span><br>port = <span class="hljs-number">8080</span><br><br>s = socket.socket(socket.AF_INET, protocol)<br><span class="hljs-keyword">if</span> protocol == socket.SOCK_STREAM:<br>    s.connect((server, port))<br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    message = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;Enter your message: &#x27;</span>)<br>    <span class="hljs-keyword">if</span> protocol == socket.SOCK_DGRAM:<br>        s.sendto(message.encode(), (server, port))<br>        <span class="hljs-keyword">if</span> message == <span class="hljs-string">&#x27;q&#x27;</span>:<br>            <span class="hljs-keyword">break</span><br>        response, addr = s.recvfrom(<span class="hljs-number">1024</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;server: &#x27;</span>+response.decode())<br>        <span class="hljs-keyword">continue</span><br>    s.send(message.encode())<br>    <span class="hljs-keyword">if</span> message == <span class="hljs-string">&#x27;q&#x27;</span>:<br>        <span class="hljs-keyword">break</span><br>    response = s.recv(<span class="hljs-number">1024</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;server: &#x27;</span>+response.decode())<br><br>s.close()<br></code></pre></td></tr></table></figure>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" class="category-chain-item">计算机网络</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/socket/" class="print-no-link">#socket</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>experiment of socket</div>
      <div>https://symcreg.github.io/2024/11/21/experiment-of-socket/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>sam</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年11月21日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/11/22/%E8%AF%97%E8%AF%8D%E6%A0%BC%E5%BE%8B/" title="诗词格律">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">诗词格律</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/09/28/high-order-control-barrier-functions-with-time-varying-output-constraints/" title="high order control barrier functions with time varying output constraints">
                        <span class="hidden-mobile">high order control barrier functions with time varying output constraints</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="gitalk-container"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#gitalk-container', function() {
      Fluid.utils.createCssLink('/css/gitalk.css')
      Fluid.utils.createScript('https://lib.baomitu.com/gitalk/1.8.0/gitalk.min.js', function() {
        var options = Object.assign(
          {"clientID":"Ov23liugDNyLrIwI2YOT","clientSecret":"c61cdde2c33263524dc52410207af08933347466","repo":"symcreg.github.io","owner":"symcreg","admin":["symcreg"],"language":"zh-CN","labels":["Gitalk"],"perPage":10,"pagerDirection":"last","distractionFreeMode":false,"createIssueManually":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token"},
          {
            id: '64d948fd362e6b2a3f9444066979154d'
          }
        )
        var gitalk = new Gitalk(options);
        gitalk.render('gitalk-container');
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
